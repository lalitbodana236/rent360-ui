"use strict";(self.webpackChunkrent360=self.webpackChunkrent360||[]).push([[196],{6196:(X,m,a)=>{a.r(m),a.d(m,{PropertiesModule:()=>z});var y=a(3128),U=a(4466),o=a(4006),t=a(8256),x=a(1135),d=a(9646),g=a(4004),v=a(8505),c=a(2340),b=a(3632),h=a(5523),A=a(1598),q=a(1312);let T=(()=>{class r{constructor(e,i){this.apiClient=e,this.refresh=i,this.mockStoreKey=b.l,this.state$=new x.X([]),this.initialized=!1}getProperties(){if(this.initialized)return this.state$.asObservable();if(c.N.api.useMockApi){const e=this.readMockStore();if(e)return this.initialized=!0,this.state$.next(this.normalizeProperties(e)),this.state$.asObservable()}return this.apiClient.get({endpoint:h.P.properties.list,mockPath:"properties/units.json"}).pipe((0,g.U)(e=>this.normalizeProperties(e.properties??[])),(0,v.b)(e=>{this.initialized=!0,this.state$.next(e),this.writeMockStore(e),this.refresh.notifyPropertiesChanged()}),(0,g.U)(()=>this.state$.value))}createProperty(e){if(!c.N.api.useMockApi)return this.apiClient.post(h.P.properties.create,e);const i={id:this.makeId("prop"),name:e.name.trim(),city:e.city.trim(),address:e.address.trim(),description:e.description.trim(),ownerName:e.ownerName.trim(),status:e.status,units:[]},n=[i,...this.state$.value];return this.state$.next(n),this.writeMockStore(n),this.refresh.notifyPropertiesChanged(),(0,d.of)(i)}updateProperty(e){if(!c.N.api.useMockApi)return this.apiClient.put(`properties/${e.id}`,e);let i;const n=this.state$.value.map(u=>u.id!==e.id?u:(i={...u,name:e.name.trim(),city:e.city.trim(),address:e.address.trim(),description:e.description.trim(),ownerName:e.ownerName.trim(),status:e.status},i));if(void 0===i)throw new Error("Property not found for update.");return this.state$.next(n),this.writeMockStore(n),this.refresh.notifyPropertiesChanged(),(0,d.of)(i)}upsertUnit(e){if(!c.N.api.useMockApi)return e.id?this.apiClient.put(`properties/${e.propertyId}/units/${e.id}`,e):this.apiClient.post(`properties/${e.propertyId}/units`,e);const i=e.media.filter(l=>l.url.trim().length>0).map(l=>({...l,url:l.url.trim(),title:l.title.trim()})),n={id:e.id??this.makeId("unit"),unitCode:e.unitCode.trim(),configuration:e.configuration,type:e.configuration,furnishing:e.furnishing,rent:Number(e.rent)||0,occupancyStatus:e.occupancyStatus,tenantName:e.tenantName.trim(),carpetAreaSqFt:Number(e.carpetAreaSqFt)||0,parking:{twoWheelerSlots:Number(e.parking.twoWheelerSlots)||0,fourWheelerSlots:Number(e.parking.fourWheelerSlots)||0},utilities:{electricityProvider:e.utilities.electricityProvider.trim(),meterNumber:e.utilities.meterNumber.trim(),gasLine:e.utilities.gasLine,waterSupply:e.utilities.waterSupply},media:i};let u=!1;const p=this.state$.value.map(l=>{if(l.id!==e.propertyId)return l;u=!0;const _=l.units.findIndex(V=>V.id===n.id);if(-1===_)return{...l,units:[...l.units,n]};const Z=[...l.units];return Z[_]=n,{...l,units:Z}});if(!u)throw new Error("Property not found for unit operation.");return this.state$.next(p),this.writeMockStore(p),this.refresh.notifyPropertiesChanged(),(0,d.of)(n)}normalizeProperties(e){return e.map(i=>({...i,address:i.address??"",description:i.description??"",units:(i.units??[]).map(n=>this.normalizeUnit(n))}))}normalizeUnit(e){const i=e.configuration??e.type??"1BHK",n=e.furnishing??"unfurnished";return{...e,configuration:i,type:e.type??i,furnishing:n,carpetAreaSqFt:Number(e.carpetAreaSqFt??0),parking:{twoWheelerSlots:Number(e.parking?.twoWheelerSlots??0),fourWheelerSlots:Number(e.parking?.fourWheelerSlots??0)},utilities:{electricityProvider:e.utilities?.electricityProvider??"",meterNumber:e.utilities?.meterNumber??"",gasLine:e.utilities?.gasLine??"no",waterSupply:e.utilities?.waterSupply??"corporation"},media:(e.media??[]).map((u,p)=>({id:u.id??`${e.id}-media-${p+1}`,type:u.type,url:u.url,title:u.title??""}))}}makeId(e){return`${e}-${Date.now()}-${Math.floor(1e3*Math.random())}`}readMockStore(){try{const e=localStorage.getItem(this.mockStoreKey);if(!e)return null;const i=JSON.parse(e);return Array.isArray(i)?i:null}catch{return null}}writeMockStore(e){if(c.N.api.useMockApi)try{localStorage.setItem(this.mockStoreKey,JSON.stringify(e))}catch{}}}return r.\u0275fac=function(e){return new(e||r)(t.LFG(A.O),t.LFG(q.y))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var P=a(263),f=a(6895),k=a(9219),C=a(2802),N=a(5213),w=a(7338);let S=(()=>{class r{constructor(e){this.settings=e,this.currency="USD",this.settings.userSettings$.subscribe(i=>{this.currency=i.currency})}transform(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:this.currency,maximumFractionDigits:2}).format(e)}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(w.s,16))},r.\u0275pipe=t.Yjl({name:"appCurrency",type:r,pure:!1}),r})();function F(r,s){if(1&r&&(t.TgZ(0,"option",25),t._uU(1),t.qZA()),2&r){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function I(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"div",26)(1,"button",27),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.openCreateProperty())}),t._uU(2,"Add Property"),t.qZA()()}}function M(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"section",5)(1,"r360-card")(2,"div",28),t._uU(3),t.qZA(),t.TgZ(4,"form",29),t.NdJ("ngSubmit",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.submitProperty())}),t.TgZ(5,"label",8),t._uU(6," Property Name "),t._UZ(7,"input",30),t.qZA(),t.TgZ(8,"label",8),t._uU(9," City "),t._UZ(10,"input",31),t.qZA(),t.TgZ(11,"label",32),t._uU(12," Address "),t._UZ(13,"input",33),t.qZA(),t.TgZ(14,"label",32),t._uU(15," Description "),t._UZ(16,"textarea",34),t.qZA(),t.TgZ(17,"label",8),t._uU(18," Owner "),t._UZ(19,"input",35),t.qZA(),t.TgZ(20,"label",8),t._uU(21," Status "),t.TgZ(22,"select",36)(23,"option",13),t._uU(24,"Active"),t.qZA(),t.TgZ(25,"option",14),t._uU(26,"Inactive"),t.qZA()()(),t.TgZ(27,"div",37)(28,"button",38),t._uU(29),t.qZA(),t.TgZ(30,"button",39),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.cancelPropertyForm())}),t._uU(31,"Cancel"),t.qZA()()()()()}if(2&r){const e=t.oxw();t.xp6(3),t.Oqu(e.editPropertyMode?"Update Property":"Create Property"),t.xp6(1),t.Q6J("formGroup",e.propertyForm),t.xp6(24),t.Q6J("disabled",e.formSubmitting),t.xp6(1),t.Oqu(e.editPropertyMode?"Update":"Create")}}function O(r,s){if(1&r&&(t.TgZ(0,"option",25),t._uU(1),t.qZA()),2&r){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function J(r,s){if(1&r&&(t.TgZ(0,"option",25),t._uU(1),t.qZA()),2&r){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function $(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"section",5)(1,"r360-card")(2,"div",28),t._uU(3),t.qZA(),t.TgZ(4,"form",40),t.NdJ("ngSubmit",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.submitUnit())}),t.TgZ(5,"label",8),t._uU(6," Unit Code "),t._UZ(7,"input",41),t.qZA(),t.TgZ(8,"label",8),t._uU(9," BHK "),t.TgZ(10,"select",42),t.YNc(11,O,2,2,"option",11),t.qZA()(),t.TgZ(12,"label",8),t._uU(13," Furnishing "),t.TgZ(14,"select",43),t.YNc(15,J,2,2,"option",11),t.qZA()(),t.TgZ(16,"label",8),t._uU(17," Monthly Rent "),t._UZ(18,"input",44),t.qZA(),t.TgZ(19,"label",8),t._uU(20," Occupancy "),t.TgZ(21,"select",45)(22,"option",46),t._uU(23,"Occupied"),t.qZA(),t.TgZ(24,"option",47),t._uU(25,"Vacant"),t.qZA(),t.TgZ(26,"option",48),t._uU(27,"Maintenance"),t.qZA()()(),t.TgZ(28,"label",8),t._uU(29," Tenant Name "),t._UZ(30,"input",49),t.qZA(),t.TgZ(31,"label",8),t._uU(32," Carpet Area (sq.ft) "),t._UZ(33,"input",50),t.qZA(),t.TgZ(34,"label",8),t._uU(35," Two Wheeler Parking "),t._UZ(36,"input",51),t.qZA(),t.TgZ(37,"label",8),t._uU(38," Four Wheeler Parking "),t._UZ(39,"input",52),t.qZA(),t.TgZ(40,"label",8),t._uU(41," Electricity Provider "),t._UZ(42,"input",53),t.qZA(),t.TgZ(43,"label",8),t._uU(44," Electricity Meter No "),t._UZ(45,"input",54),t.qZA(),t.TgZ(46,"label",8),t._uU(47," Gas Line "),t.TgZ(48,"select",55)(49,"option",56),t._uU(50,"Yes"),t.qZA(),t.TgZ(51,"option",57),t._uU(52,"No"),t.qZA()()(),t.TgZ(53,"label",8),t._uU(54," Water Supply "),t.TgZ(55,"select",58)(56,"option",59),t._uU(57,"Corporation"),t.qZA(),t.TgZ(58,"option",60),t._uU(59,"Borewell"),t.qZA(),t.TgZ(60,"option",61),t._uU(61,"Mixed"),t.qZA()()(),t.TgZ(62,"label",62),t._uU(63," Image URL "),t._UZ(64,"input",63),t.qZA(),t.TgZ(65,"label",62),t._uU(66," Video URL "),t._UZ(67,"input",64),t.qZA(),t.TgZ(68,"div",65)(69,"button",38),t._uU(70),t.qZA(),t.TgZ(71,"button",39),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.cancelUnitForm())}),t._uU(72,"Cancel"),t.qZA()()()()()}if(2&r){const e=t.oxw();t.xp6(3),t.Oqu(e.editUnitMode?"Update Unit Details":"Add Unit Details"),t.xp6(1),t.Q6J("formGroup",e.unitForm),t.xp6(7),t.Q6J("ngForOf",e.bhkOptions),t.xp6(4),t.Q6J("ngForOf",e.furnishingOptions),t.xp6(54),t.Q6J("disabled",e.formSubmitting),t.xp6(1),t.Oqu(e.editUnitMode?"Update Unit":"Create Unit")}}function L(r,s){if(1&r&&(t.TgZ(0,"div",68)(1,"div",69),t._uU(2,"Unit"),t.qZA(),t.TgZ(3,"div",70),t._uU(4),t.qZA(),t.TgZ(5,"div",77)(6,"div")(7,"span",74),t._uU(8,"Furnishing:"),t.qZA(),t._uU(9),t.qZA(),t.TgZ(10,"div")(11,"span",74),t._uU(12,"Carpet:"),t.qZA(),t._uU(13),t.qZA(),t.TgZ(14,"div")(15,"span",74),t._uU(16,"Rent:"),t.qZA(),t._uU(17),t.ALo(18,"appCurrency"),t.qZA(),t.TgZ(19,"div")(20,"span",74),t._uU(21,"Tenant:"),t.qZA(),t._uU(22),t.qZA(),t.TgZ(23,"div")(24,"span",74),t._uU(25,"2W Parking:"),t.qZA(),t._uU(26),t.qZA(),t.TgZ(27,"div")(28,"span",74),t._uU(29,"4W Parking:"),t.qZA(),t._uU(30),t.qZA(),t.TgZ(31,"div")(32,"span",74),t._uU(33,"Electricity:"),t.qZA(),t._uU(34),t.qZA(),t.TgZ(35,"div")(36,"span",74),t._uU(37,"Meter:"),t.qZA(),t._uU(38),t.qZA(),t.TgZ(39,"div")(40,"span",74),t._uU(41,"Gas Line:"),t.qZA(),t._uU(42),t.qZA(),t.TgZ(43,"div")(44,"span",74),t._uU(45,"Water:"),t.qZA(),t._uU(46),t.qZA()()()),2&r){const e=s.ngIf;t.xp6(4),t.AsE("",e.unitCode," \ufffd ",e.configuration,""),t.xp6(5),t.hij(" ",e.furnishing,""),t.xp6(4),t.hij(" ",e.carpetAreaSqFt," sq.ft"),t.xp6(4),t.hij(" ",t.lcZ(18,12,e.rent),""),t.xp6(5),t.hij(" ",e.tenantName||"-",""),t.xp6(4),t.hij(" ",e.parking.twoWheelerSlots,""),t.xp6(4),t.hij(" ",e.parking.fourWheelerSlots,""),t.xp6(4),t.hij(" ",e.utilities.electricityProvider,""),t.xp6(4),t.hij(" ",e.utilities.meterNumber,""),t.xp6(4),t.hij(" ",e.utilities.gasLine,""),t.xp6(4),t.hij(" ",e.utilities.waterSupply,"")}}function W(r,s){if(1&r&&t._UZ(0,"img",84),2&r){const e=t.oxw().$implicit,i=t.oxw(2).ngIf;t.Q6J("src",e.url,t.LSH)("alt",e.title||i.propertyName)}}function Q(r,s){if(1&r&&t._UZ(0,"video",85),2&r){const e=t.oxw().$implicit;t.Q6J("src",e.url,t.LSH)}}function E(r,s){if(1&r&&(t.TgZ(0,"div",80)(1,"div",81),t._uU(2),t.qZA(),t.YNc(3,W,1,2,"img",82),t.YNc(4,Q,1,1,"video",83),t.qZA()),2&r){const e=s.$implicit;t.xp6(2),t.Oqu(e.type),t.xp6(1),t.Q6J("ngIf","image"===e.type),t.xp6(1),t.Q6J("ngIf","video"===e.type)}}function H(r,s){if(1&r&&(t.TgZ(0,"div",78),t.YNc(1,E,5,3,"div",79),t.qZA()),2&r){const e=t.oxw().ngIf;t.xp6(1),t.Q6J("ngForOf",null==e.unit?null:e.unit.media)}}function K(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"section",5)(1,"r360-card")(2,"div",17)(3,"h3",66),t._uU(4,"Property & Unit Details"),t.qZA(),t.TgZ(5,"button",39),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.closeDetails())}),t._uU(6,"Close"),t.qZA()(),t.TgZ(7,"div",67)(8,"div",68)(9,"div",69),t._uU(10,"Property"),t.qZA(),t.TgZ(11,"div",70),t._uU(12),t.qZA(),t.TgZ(13,"div",71),t._uU(14),t.qZA(),t.TgZ(15,"div",71),t._uU(16),t.qZA(),t.TgZ(17,"div",72),t._uU(18),t.qZA(),t.TgZ(19,"div",73)(20,"span",74),t._uU(21,"Owner:"),t.qZA(),t._uU(22),t.qZA()(),t.YNc(23,L,47,14,"div",75),t.qZA(),t.YNc(24,H,2,1,"div",76),t.qZA()()}if(2&r){const e=s.ngIf;t.xp6(12),t.Oqu(e.propertyName),t.xp6(2),t.Oqu(e.address),t.xp6(2),t.Oqu(e.city),t.xp6(2),t.Oqu(e.description),t.xp6(4),t.hij(" ",e.ownerName,""),t.xp6(1),t.Q6J("ngIf",e.unit),t.xp6(1),t.Q6J("ngIf",null==e.unit||null==e.unit.media?null:e.unit.media.length)}}function j(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"button",97),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2).$implicit,u=t.oxw();return t.KtG(u.editPropertyFromRow(n.propertyId))}),t._uU(1,"Edit Property"),t.qZA()}}function Y(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"button",97),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2).$implicit,u=t.oxw();return t.KtG(u.openEditUnit(n))}),t._uU(1,"Edit Unit"),t.qZA()}}function D(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"button",97),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2).$implicit,u=t.oxw();return t.KtG(u.openCreateUnit(n.propertyId))}),t._uU(1,"Add Unit"),t.qZA()}}function R(r,s){if(1&r){const e=t.EpF();t.O4$(),t.kcU(),t.TgZ(0,"div",96)(1,"button",97),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,u=t.oxw();return t.KtG(u.viewRowDetails(n))}),t._uU(2,"View"),t.qZA(),t.YNc(3,j,2,0,"button",98),t.YNc(4,Y,2,0,"button",98),t.YNc(5,D,2,0,"button",98),t.qZA()}if(2&r){const e=t.oxw().$implicit,i=t.oxw();t.xp6(3),t.Q6J("ngIf",i.canEdit),t.xp6(1),t.Q6J("ngIf",i.canEdit&&e.unit),t.xp6(1),t.Q6J("ngIf",i.canEdit&&!e.unit)}}function B(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"tr",86)(1,"td",87),t._uU(2),t.qZA(),t.TgZ(3,"td",88),t._uU(4),t.qZA(),t.TgZ(5,"td",88),t._uU(6),t.qZA(),t.TgZ(7,"td",88),t._uU(8),t.qZA(),t.TgZ(9,"td",88),t._uU(10),t.qZA(),t.TgZ(11,"td",88),t._uU(12),t.ALo(13,"appCurrency"),t.qZA(),t.TgZ(14,"td",88),t._uU(15),t.qZA(),t.TgZ(16,"td",88),t._uU(17),t.qZA(),t.TgZ(18,"td",88),t._uU(19),t.qZA(),t.TgZ(20,"td",88),t._uU(21),t.qZA(),t.TgZ(22,"td",88),t._UZ(23,"r360-status-badge",25),t.qZA(),t.TgZ(24,"td",88)(25,"div",89),t.NdJ("click",function(n){return n.stopPropagation()}),t.TgZ(26,"button",90),t.NdJ("click",function(n){const p=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.toggleActionMenu(n,p))}),t.O4$(),t.TgZ(27,"svg",91),t._UZ(28,"circle",92)(29,"circle",93)(30,"circle",94),t.qZA()(),t.YNc(31,R,6,3,"div",95),t.qZA()()()}if(2&r){const e=s.$implicit,i=t.oxw();t.xp6(2),t.Oqu(e.propertyName),t.xp6(2),t.Oqu(e.city),t.xp6(2),t.Oqu((null==e.unit?null:e.unit.unitCode)||"-"),t.xp6(2),t.Oqu((null==e.unit?null:e.unit.configuration)||"-"),t.xp6(2),t.Oqu((null==e.unit?null:e.unit.furnishing)||"-"),t.xp6(2),t.Oqu(e.unit?t.lcZ(13,12,e.unit.rent):"-"),t.xp6(3),t.Oqu(null!=e.unit&&e.unit.carpetAreaSqFt?(null==e.unit?null:e.unit.carpetAreaSqFt)+" sq.ft":"-"),t.xp6(2),t.Oqu(e.unit?e.unit.parking.twoWheelerSlots+" / "+e.unit.parking.fourWheelerSlots:"-"),t.xp6(2),t.Oqu(e.unit?e.unit.utilities.electricityProvider+" \ufffd "+e.unit.utilities.gasLine:"-"),t.xp6(2),t.Oqu((null==e.unit||null==e.unit.media?null:e.unit.media.length)||0),t.xp6(2),t.Q6J("value",(null==e.unit?null:e.unit.occupancyStatus)||e.propertyStatus),t.xp6(8),t.Q6J("ngIf",i.isActionMenuOpen(e))}}const G=[{path:"",component:(()=>{class r{constructor(e,i,n){this.fb=e,this.propertiesData=i,this.auth=n,this.properties=[],this.filteredRows=[],this.search="",this.selectedProperty="All",this.selectedStatus="All",this.showPropertyForm=!1,this.showUnitForm=!1,this.editPropertyMode=!1,this.editUnitMode=!1,this.editingPropertyId="",this.editingUnitId="",this.selectedRow=null,this.formSubmitting=!1,this.openActionMenuId=null,this.bhkOptions=["studio","1BHK","2BHK","3BHK","4BHK","5BHK+"],this.furnishingOptions=["unfurnished","semi-furnished","furnished"],this.propertyForm=this.fb.group({name:["",[o.kI.required,o.kI.minLength(2)]],city:["",[o.kI.required,o.kI.minLength(2)]],address:["",[o.kI.required,o.kI.minLength(5)]],description:["",[o.kI.required,o.kI.minLength(5)]],ownerName:["",[o.kI.required,o.kI.minLength(2)]],status:["active",o.kI.required]}),this.unitForm=this.fb.group({propertyId:["",o.kI.required],unitCode:["",[o.kI.required,o.kI.minLength(2)]],configuration:["1BHK",o.kI.required],furnishing:["unfurnished",o.kI.required],rent:[0,[o.kI.required,o.kI.min(0)]],occupancyStatus:["vacant",o.kI.required],tenantName:[""],carpetAreaSqFt:[0,[o.kI.required,o.kI.min(0)]],parkingTwoWheeler:[0,[o.kI.required,o.kI.min(0)]],parkingFourWheeler:[0,[o.kI.required,o.kI.min(0)]],electricityProvider:["",o.kI.required],meterNumber:["",o.kI.required],gasLine:["yes",o.kI.required],waterSupply:["corporation",o.kI.required],imageUrl:[""],videoUrl:[""]})}ngOnInit(){this.propertiesData.getProperties().subscribe(e=>{this.properties=e,this.applyFilters()})}get canEdit(){return this.auth.hasAnyRole(["owner","societyAdmin"])}get propertyOptions(){return["All",...this.properties.map(e=>e.name)]}get totalProperties(){return this.properties.length}get totalUnits(){return this.properties.reduce((e,i)=>e+i.units.length,0)}get occupiedUnits(){return this.properties.flatMap(e=>e.units).filter(e=>"occupied"===e.occupancyStatus).length}get vacantUnits(){return this.properties.flatMap(e=>e.units).filter(e=>"vacant"===e.occupancyStatus).length}onSearch(e){this.search=e,this.applyFilters()}onPropertyFilter(e){this.selectedProperty=e,this.applyFilters()}onStatusFilter(e){this.selectedStatus=e,this.applyFilters()}rowMenuId(e){return`${e.propertyId}-${e.unit?.id??"no-unit"}`}toggleActionMenu(e,i){e.stopPropagation();const n=this.rowMenuId(i);this.openActionMenuId=this.openActionMenuId===n?null:n}isActionMenuOpen(e){return this.openActionMenuId===this.rowMenuId(e)}closeActionMenu(){this.openActionMenuId=null}onDocumentClick(){this.closeActionMenu()}openCreateProperty(){this.editPropertyMode=!1,this.editingPropertyId="",this.propertyForm.reset({name:"",city:"",address:"",description:"",ownerName:this.auth.snapshotUser?.fullName??"",status:"active"}),this.showPropertyForm=!0}openEditProperty(e){this.editPropertyMode=!0,this.editingPropertyId=e.id,this.propertyForm.reset({name:e.name,city:e.city,address:e.address,description:e.description,ownerName:e.ownerName,status:e.status}),this.showPropertyForm=!0}editPropertyFromRow(e){const i=this.properties.find(n=>n.id===e);i&&this.openEditProperty(i)}openCreateUnit(e){this.editUnitMode=!1,this.editingUnitId="",this.unitForm.reset({propertyId:e,unitCode:"",configuration:"1BHK",furnishing:"unfurnished",rent:0,occupancyStatus:"vacant",tenantName:"",carpetAreaSqFt:0,parkingTwoWheeler:0,parkingFourWheeler:0,electricityProvider:"",meterNumber:"",gasLine:"yes",waterSupply:"corporation",imageUrl:"",videoUrl:""}),this.showUnitForm=!0}openEditUnit(e){if(!e.unit)return;const i=e.unit.media.find(u=>"image"===u.type)?.url??"",n=e.unit.media.find(u=>"video"===u.type)?.url??"";this.editUnitMode=!0,this.editingUnitId=e.unit.id,this.unitForm.reset({propertyId:e.propertyId,unitCode:e.unit.unitCode,configuration:e.unit.configuration,furnishing:e.unit.furnishing,rent:e.unit.rent,occupancyStatus:e.unit.occupancyStatus,tenantName:e.unit.tenantName,carpetAreaSqFt:e.unit.carpetAreaSqFt,parkingTwoWheeler:e.unit.parking.twoWheelerSlots,parkingFourWheeler:e.unit.parking.fourWheelerSlots,electricityProvider:e.unit.utilities.electricityProvider,meterNumber:e.unit.utilities.meterNumber,gasLine:e.unit.utilities.gasLine,waterSupply:e.unit.utilities.waterSupply,imageUrl:i,videoUrl:n}),this.showUnitForm=!0}viewRowDetails(e){this.selectedRow=e}closeDetails(){this.selectedRow=null}cancelPropertyForm(){this.showPropertyForm=!1,this.formSubmitting=!1}cancelUnitForm(){this.showUnitForm=!1,this.formSubmitting=!1}submitProperty(){if(this.propertyForm.invalid||this.formSubmitting)return void this.propertyForm.markAllAsTouched();const e=this.propertyForm.getRawValue();this.formSubmitting=!0,(this.editPropertyMode?this.propertiesData.updateProperty({...e,id:this.editingPropertyId}):this.propertiesData.createProperty(e)).subscribe({next:()=>{this.formSubmitting=!1,this.showPropertyForm=!1,this.applyFilters()},error:()=>{this.formSubmitting=!1}})}submitUnit(){if(this.unitForm.invalid||this.formSubmitting)return void this.unitForm.markAllAsTouched();const e=this.unitForm.getRawValue(),i=(e.imageUrl??"").trim(),n=(e.videoUrl??"").trim(),u=[{id:`${e.propertyId}-image`,type:"image",url:i,title:"Unit image"},{id:`${e.propertyId}-video`,type:"video",url:n,title:"Unit video"}].filter(l=>!!l.url),p={id:this.editUnitMode?this.editingUnitId:void 0,propertyId:e.propertyId??"",unitCode:e.unitCode??"",configuration:e.configuration??"1BHK",furnishing:e.furnishing??"unfurnished",rent:Number(e.rent)||0,occupancyStatus:e.occupancyStatus??"vacant",tenantName:e.tenantName??"",carpetAreaSqFt:Number(e.carpetAreaSqFt)||0,parking:{twoWheelerSlots:Number(e.parkingTwoWheeler)||0,fourWheelerSlots:Number(e.parkingFourWheeler)||0},utilities:{electricityProvider:e.electricityProvider??"",meterNumber:e.meterNumber??"",gasLine:e.gasLine??"yes",waterSupply:e.waterSupply??"corporation"},media:u};this.formSubmitting=!0,this.propertiesData.upsertUnit(p).subscribe({next:()=>{this.formSubmitting=!1,this.showUnitForm=!1,this.applyFilters()},error:()=>{this.formSubmitting=!1}})}applyFilters(){const e=this.search.trim().toLowerCase();this.filteredRows=this.properties.filter(i=>"All"===this.selectedProperty||i.name===this.selectedProperty).filter(i=>"All"===this.selectedStatus||i.status===this.selectedStatus).flatMap(i=>i.units.length?i.units.map(n=>({propertyId:i.id,propertyName:i.name,propertyStatus:i.status,city:i.city,address:i.address,description:i.description,ownerName:i.ownerName,unit:n})):[{propertyId:i.id,propertyName:i.name,propertyStatus:i.status,city:i.city,address:i.address,description:i.description,ownerName:i.ownerName,unit:void 0}]).filter(i=>!e||[i.propertyName,i.city,i.address,i.ownerName,i.unit?.unitCode??"",i.unit?.configuration??"",i.unit?.furnishing??"",i.unit?.tenantName??"",i.unit?.utilities.electricityProvider??"",i.unit?.utilities.meterNumber??""].join(" ").toLowerCase().includes(e))}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(o.qu),t.Y36(T),t.Y36(P.e))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-properties"]],hostBindings:function(e,i){1&e&&t.NdJ("click",function(){return i.onDocumentClick()},!1,t.evT)},decls:84,vars:14,consts:[[1,"r360-page"],["title","Properties & Units","subtitle","Detailed property intelligence with media, utilities, parking and unit configuration"],[1,"r360-section","grid","grid-cols-1","gap-4","sm:grid-cols-2","xl:grid-cols-4"],[1,"text-xs","uppercase","tracking-wide","text-gray-500"],[1,"mt-2","text-3xl","font-bold","text-gray-900","dark:text-gray-100"],[1,"r360-section"],[1,"flex","flex-col","gap-3","lg:flex-row","lg:items-end","lg:justify-between"],[1,"grid","grid-cols-1","gap-3","sm:grid-cols-3","lg:min-w-[620px]","lg:flex-1"],[1,"text-xs","font-medium","text-gray-500","dark:text-gray-300"],["type","text","placeholder","Property, unit, BHK, furnishing, utility",1,"r360-input","mt-1",3,"value","input"],[1,"r360-input","mt-1",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],["value","All"],["value","active"],["value","inactive"],["class","flex items-center gap-2",4,"ngIf"],["class","r360-section",4,"ngIf"],[1,"mb-4","flex","items-center","justify-between"],[1,"text-xl","font-semibold"],[1,"text-xs","text-gray-500"],[1,"r360-table-wrap"],[1,"r360-table"],[1,"border-b","border-gray-200","dark:border-gray-700"],[1,"r360-th"],["class","r360-row",4,"ngFor","ngForOf"],[3,"value"],[1,"flex","items-center","gap-2"],["type","button",1,"r360-btn-primary",3,"click"],[1,"mb-4","text-lg","font-semibold"],[1,"grid","grid-cols-1","gap-3","sm:grid-cols-2",3,"formGroup","ngSubmit"],["type","text","formControlName","name","placeholder","e.g. Palm Residency",1,"r360-input","mt-1"],["type","text","formControlName","city","placeholder","e.g. Austin",1,"r360-input","mt-1"],[1,"text-xs","font-medium","text-gray-500","dark:text-gray-300","sm:col-span-2"],["type","text","formControlName","address","placeholder","Street, area, city, zip",1,"r360-input","mt-1"],["formControlName","description","placeholder","Mention highlights like gated community, amenities, nearby access",1,"r360-input","mt-1","min-h-[88px]"],["type","text","formControlName","ownerName","placeholder","Owner full name",1,"r360-input","mt-1"],["formControlName","status",1,"r360-input","mt-1"],[1,"sm:col-span-2","flex","flex-wrap","gap-2","pt-2"],["type","submit",1,"r360-btn-primary",3,"disabled"],["type","button",1,"r360-btn-secondary",3,"click"],[1,"grid","grid-cols-1","gap-3","sm:grid-cols-2","xl:grid-cols-3",3,"formGroup","ngSubmit"],["type","text","formControlName","unitCode","placeholder","A-101",1,"r360-input","mt-1"],["formControlName","configuration",1,"r360-input","mt-1"],["formControlName","furnishing",1,"r360-input","mt-1"],["type","number","formControlName","rent",1,"r360-input","mt-1"],["formControlName","occupancyStatus",1,"r360-input","mt-1"],["value","occupied"],["value","vacant"],["value","maintenance"],["type","text","formControlName","tenantName","placeholder","Tenant full name",1,"r360-input","mt-1"],["type","number","formControlName","carpetAreaSqFt",1,"r360-input","mt-1"],["type","number","formControlName","parkingTwoWheeler",1,"r360-input","mt-1"],["type","number","formControlName","parkingFourWheeler",1,"r360-input","mt-1"],["type","text","formControlName","electricityProvider","placeholder","City Power",1,"r360-input","mt-1"],["type","text","formControlName","meterNumber","placeholder","MTR-12345",1,"r360-input","mt-1"],["formControlName","gasLine",1,"r360-input","mt-1"],["value","yes"],["value","no"],["formControlName","waterSupply",1,"r360-input","mt-1"],["value","corporation"],["value","borewell"],["value","mixed"],[1,"text-xs","font-medium","text-gray-500","dark:text-gray-300","xl:col-span-2"],["type","text","formControlName","imageUrl","placeholder","https://...jpg",1,"r360-input","mt-1"],["type","text","formControlName","videoUrl","placeholder","https://...mp4",1,"r360-input","mt-1"],[1,"xl:col-span-3","flex","flex-wrap","gap-2","pt-2"],[1,"text-lg","font-semibold"],[1,"grid","grid-cols-1","gap-4","lg:grid-cols-2"],[1,"rounded-xl","border","border-gray-200","bg-gray-50","p-4","dark:border-gray-700","dark:bg-gray-800/40"],[1,"text-xs","uppercase","text-gray-500"],[1,"mt-2","text-lg","font-semibold","text-gray-900","dark:text-gray-100"],[1,"mt-1","text-sm","text-gray-600","dark:text-gray-300"],[1,"mt-2","text-sm","text-gray-700","dark:text-gray-200"],[1,"mt-3","text-sm"],[1,"font-semibold"],["class","rounded-xl border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800/40",4,"ngIf"],["class","mt-4 grid grid-cols-1 gap-4 lg:grid-cols-2",4,"ngIf"],[1,"mt-2","grid","grid-cols-2","gap-2","text-sm","text-gray-700","dark:text-gray-200"],[1,"mt-4","grid","grid-cols-1","gap-4","lg:grid-cols-2"],["class","rounded-xl border border-gray-200 p-3 dark:border-gray-700",4,"ngFor","ngForOf"],[1,"rounded-xl","border","border-gray-200","p-3","dark:border-gray-700"],[1,"mb-2","text-xs","uppercase","text-gray-500"],["class","h-44 w-full rounded-lg object-cover",3,"src","alt",4,"ngIf"],["controls","","class","h-44 w-full rounded-lg object-cover bg-black",3,"src",4,"ngIf"],[1,"h-44","w-full","rounded-lg","object-cover",3,"src","alt"],["controls","",1,"h-44","w-full","rounded-lg","object-cover","bg-black",3,"src"],[1,"r360-row"],[1,"r360-td","font-semibold","text-gray-900","dark:text-gray-100"],[1,"r360-td"],[1,"relative","inline-block","text-left",3,"click"],["type","button","aria-label","More actions",1,"inline-flex","h-9","w-9","items-center","justify-center","rounded-lg","border","border-gray-200","bg-white","text-gray-600","hover:bg-gray-50","dark:border-gray-700","dark:bg-gray-900","dark:text-gray-300","dark:hover:bg-gray-800",3,"click"],["viewBox","0 0 24 24",1,"h-5","w-5","fill-current"],["cx","12","cy","5","r","1.8"],["cx","12","cy","12","r","1.8"],["cx","12","cy","19","r","1.8"],["class","absolute right-0 z-20 mt-2 w-44 overflow-hidden rounded-xl border border-gray-200 bg-white shadow-md dark:border-gray-700 dark:bg-gray-900",4,"ngIf"],[1,"absolute","right-0","z-20","mt-2","w-44","overflow-hidden","rounded-xl","border","border-gray-200","bg-white","shadow-md","dark:border-gray-700","dark:bg-gray-900"],["type","button",1,"block","w-full","px-3","py-2","text-left","text-sm","hover:bg-gray-50","dark:hover:bg-gray-800",3,"click"],["class","block w-full px-3 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-800","type","button",3,"click",4,"ngIf"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"r360-page-header",1),t.TgZ(2,"section",2)(3,"r360-card")(4,"div",3),t._uU(5,"Total Properties"),t.qZA(),t.TgZ(6,"div",4),t._uU(7),t.qZA()(),t.TgZ(8,"r360-card")(9,"div",3),t._uU(10,"Total Units"),t.qZA(),t.TgZ(11,"div",4),t._uU(12),t.qZA()(),t.TgZ(13,"r360-card")(14,"div",3),t._uU(15,"Occupied Units"),t.qZA(),t.TgZ(16,"div",4),t._uU(17),t.qZA()(),t.TgZ(18,"r360-card")(19,"div",3),t._uU(20,"Vacant Units"),t.qZA(),t.TgZ(21,"div",4),t._uU(22),t.qZA()()(),t.TgZ(23,"section",5)(24,"r360-card")(25,"div",6)(26,"div",7)(27,"label",8),t._uU(28," Search "),t.TgZ(29,"input",9),t.NdJ("input",function(u){return i.onSearch(u.target.value)}),t.qZA()(),t.TgZ(30,"label",8),t._uU(31," Property "),t.TgZ(32,"select",10),t.NdJ("change",function(u){return i.onPropertyFilter(u.target.value)}),t.YNc(33,F,2,2,"option",11),t.qZA()(),t.TgZ(34,"label",8),t._uU(35," Status "),t.TgZ(36,"select",10),t.NdJ("change",function(u){return i.onStatusFilter(u.target.value)}),t.TgZ(37,"option",12),t._uU(38,"All"),t.qZA(),t.TgZ(39,"option",13),t._uU(40,"Active"),t.qZA(),t.TgZ(41,"option",14),t._uU(42,"Inactive"),t.qZA()()()(),t.YNc(43,I,3,0,"div",15),t.qZA()()(),t.YNc(44,M,32,4,"section",16),t.YNc(45,$,73,6,"section",16),t.YNc(46,K,25,7,"section",16),t.TgZ(47,"section",5)(48,"r360-card")(49,"div",17)(50,"h3",18),t._uU(51,"Properties & Units"),t.qZA(),t.TgZ(52,"span",19),t._uU(53),t.qZA()(),t.TgZ(54,"div",20)(55,"table",21)(56,"thead")(57,"tr",22)(58,"th",23),t._uU(59,"Property"),t.qZA(),t.TgZ(60,"th",23),t._uU(61,"City"),t.qZA(),t.TgZ(62,"th",23),t._uU(63,"Unit"),t.qZA(),t.TgZ(64,"th",23),t._uU(65,"BHK"),t.qZA(),t.TgZ(66,"th",23),t._uU(67,"Furnishing"),t.qZA(),t.TgZ(68,"th",23),t._uU(69,"Rent"),t.qZA(),t.TgZ(70,"th",23),t._uU(71,"Carpet"),t.qZA(),t.TgZ(72,"th",23),t._uU(73,"Parking"),t.qZA(),t.TgZ(74,"th",23),t._uU(75,"Utilities"),t.qZA(),t.TgZ(76,"th",23),t._uU(77,"Media"),t.qZA(),t.TgZ(78,"th",23),t._uU(79,"Status"),t.qZA(),t.TgZ(80,"th",23),t._uU(81,"Actions"),t.qZA()()(),t.TgZ(82,"tbody"),t.YNc(83,B,32,14,"tr",24),t.qZA()()()()()()),2&e&&(t.xp6(7),t.Oqu(i.totalProperties),t.xp6(5),t.Oqu(i.totalUnits),t.xp6(5),t.Oqu(i.occupiedUnits),t.xp6(5),t.Oqu(i.vacantUnits),t.xp6(7),t.Q6J("value",i.search),t.xp6(3),t.Q6J("value",i.selectedProperty),t.xp6(1),t.Q6J("ngForOf",i.propertyOptions),t.xp6(3),t.Q6J("value",i.selectedStatus),t.xp6(7),t.Q6J("ngIf",i.canEdit),t.xp6(1),t.Q6J("ngIf",i.showPropertyForm&&i.canEdit),t.xp6(1),t.Q6J("ngIf",i.showUnitForm&&i.canEdit),t.xp6(1),t.Q6J("ngIf",i.selectedRow),t.xp6(7),t.hij("",i.filteredRows.length," rows"),t.xp6(30),t.Q6J("ngForOf",i.filteredRows))},dependencies:[f.sg,f.O5,o._Y,o.YN,o.Kr,o.Fj,o.wV,o.EJ,o.JJ,o.JL,o.sg,o.u,k.A,C.q,N.e,S]}),r})()}];let z=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[U.m,y.Bz.forChild(G)]}),r})()}}]);