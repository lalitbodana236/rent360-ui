<div class="r360-page">
  <r360-page-header title="Tenants" [subtitle]="subtitle"></r360-page-header>

  <section class="r360-section grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4">
    <r360-card>
      <div class="text-xs uppercase tracking-wide text-gray-500">Visible Tenants</div>
      <div class="mt-2 text-3xl font-bold text-gray-900 dark:text-gray-100">{{ totalTenants }}</div>
    </r360-card>
    <r360-card>
      <div class="text-xs uppercase tracking-wide text-gray-500">Due Soon</div>
      <div class="mt-2 text-3xl font-bold text-warning">{{ dueSoonTenants }}</div>
    </r360-card>
    <r360-card>
      <div class="text-xs uppercase tracking-wide text-gray-500">Overdue</div>
      <div class="mt-2 text-3xl font-bold text-danger">{{ overdueTenants }}</div>
    </r360-card>
    <r360-card>
      <div class="text-xs uppercase tracking-wide text-gray-500">Pending Dues</div>
      <div class="mt-2 text-3xl font-bold text-gray-900 dark:text-gray-100">{{ pendingDuesTotal | appCurrency }}</div>
    </r360-card>
  </section>

  <section class="r360-section">
    <r360-card>
      <div class="grid grid-cols-1 gap-3 sm:grid-cols-3">
        <label class="r360-label">
          Search
          <input
            class="r360-input mt-1"
            type="text"
            [value]="search"
            (input)="onSearch($any($event.target).value)"
            placeholder="Tenant, property, unit, owner"
          />
        </label>

        <label class="r360-label">
          Property
          <select class="r360-input mt-1" [value]="selectedProperty" (change)="onPropertyFilter($any($event.target).value)">
            <option *ngFor="let option of propertyOptions" [value]="option">{{ option }}</option>
          </select>
        </label>

        <label class="r360-label">
          Health
          <select class="r360-input mt-1" [value]="selectedStatus" (change)="onStatusFilter($any($event.target).value)">
            <option value="All">All</option>
            <option value="On Track">On Track</option>
            <option value="Due Soon">Due Soon</option>
            <option value="Overdue">Overdue</option>
          </select>
        </label>
      </div>
    </r360-card>
  </section>

  <section class="r360-section" *ngIf="selectedTenant as tenant">
    <r360-card>
      <div class="mb-4 flex items-center justify-between">
        <h3 class="text-lg font-semibold">Tenant Snapshot</h3>
        <button class="r360-btn-secondary" type="button" (click)="closeTenant()">Close</button>
      </div>

      <div class="grid grid-cols-1 gap-4 lg:grid-cols-3">
        <div class="r360-panel">
          <div class="text-xs uppercase tracking-wide text-gray-500">Tenant</div>
          <div class="mt-2 text-xl font-semibold">{{ tenant.name }}</div>
          <div class="mt-2 text-sm text-gray-600 dark:text-gray-300">Unit {{ tenant.unit }}, {{ tenant.property }}</div>
          <div class="mt-1 text-sm text-gray-600 dark:text-gray-300">{{ tenant.city }}</div>
        </div>
        <div class="r360-panel">
          <div class="text-xs uppercase tracking-wide text-gray-500">Financial</div>
          <div class="mt-2 text-sm"><span class="font-semibold">Rent:</span> {{ tenant.rent | appCurrency }}</div>
          <div class="mt-1 text-sm"><span class="font-semibold">Pending:</span> {{ tenant.pendingDues | appCurrency }}</div>
          <div class="mt-1 text-sm"><span class="font-semibold">Lease End:</span> {{ tenant.leaseEnd | appDate }}</div>
        </div>
        <div class="r360-panel">
          <div class="text-xs uppercase tracking-wide text-gray-500">Owner & Action</div>
          <div class="mt-2 text-sm"><span class="font-semibold">Owner:</span> {{ tenant.ownerName }}</div>
          <div class="mt-1 text-sm"><span class="font-semibold">Status:</span> {{ tenant.status }}</div>
          <div class="mt-3 flex flex-wrap gap-2">
            <button class="r360-btn-secondary" *ngIf="canManageTenantActions" type="button">Contact</button>
            <button class="r360-btn-primary" type="button">{{ canManageTenantActions ? 'Open Ledger' : 'View My Ledger' }}</button>
          </div>
        </div>
      </div>
    </r360-card>
  </section>

  <section class="r360-section">
    <r360-card>
      <div class="r360-table-wrap">
        <table class="r360-table">
          <thead>
            <tr class="border-b border-gray-200 dark:border-gray-700">
              <th class="r360-th">Tenant</th>
              <th class="r360-th">Property</th>
              <th class="r360-th">Unit</th>
              <th class="r360-th">Monthly Rent</th>
              <th class="r360-th">Pending Dues</th>
              <th class="r360-th">Lease End</th>
              <th class="r360-th">Health</th>
              <th class="r360-th">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of filteredTenants" class="r360-row">
              <td class="r360-td">{{ row.name }}</td>
              <td class="r360-td">{{ row.property }}</td>
              <td class="r360-td">{{ row.unit }}</td>
              <td class="r360-td">{{ row.rent | appCurrency }}</td>
              <td class="r360-td">{{ row.pendingDues | appCurrency }}</td>
              <td class="r360-td">{{ row.leaseEnd | appDate }}</td>
              <td class="r360-td">
                <span class="tenant-chip" [class.tenant-chip-warning]="row.status === 'Due Soon'" [class.tenant-chip-danger]="row.status === 'Overdue'">
                  {{ row.status }}
                </span>
              </td>
              <td class="r360-td">
                <button class="r360-btn-secondary" *ngIf="canViewTenantActions" type="button" (click)="openTenant(row)">
                  {{ canManageTenantActions ? 'Manage' : 'View' }}
                </button>
                <span class="text-xs text-gray-500" *ngIf="!canViewTenantActions">No access</span>
              </td>
            </tr>
            <tr class="r360-row" *ngIf="!filteredTenants.length">
              <td class="r360-td text-sm text-gray-500" colspan="8">No tenant records are available for your current role and filters.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </r360-card>
  </section>
</div>
