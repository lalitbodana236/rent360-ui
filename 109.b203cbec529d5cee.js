"use strict";(self.webpackChunkrent360=self.webpackChunkrent360||[]).push([[109],{4109:(st,h,c)=>{c.r(h),c.d(h,{PropertiesModule:()=>nt});var v=c(5675),U=c(4466),s=c(4006),y=c(8327),t=c(8256),A=c(1135),l=c(2843),_=c(9646),f=c(4004),T=c(8505),d=c(2340),q=c(3632),m=c(5523),b=c(1598),P=c(1312);let C=(()=>{class i{constructor(e,r){this.apiClient=e,this.refresh=r,this.mockStoreKey=q.l,this.state$=new A.X([]),this.initialized=!1}getProperties(){if(this.initialized)return this.state$.asObservable();if(d.N.api.useMockApi){const e=this.readMockStore();if(e)return this.initialized=!0,this.state$.next(this.normalizeProperties(e)),this.state$.asObservable()}return this.apiClient.get({endpoint:m.P.properties.list,mockPath:"properties/units.json"}).pipe((0,f.U)(e=>this.normalizeProperties(e.properties??[])),(0,T.b)(e=>{this.initialized=!0,this.state$.next(e),this.writeMockStore(e),this.refresh.notifyPropertiesChanged()}),(0,f.U)(()=>this.state$.value))}createProperty(e){if(!d.N.api.useMockApi)return this.apiClient.post(m.P.properties.create,e);if(this.isDuplicateProperty(e))return(0,l._)(()=>new Error("Property already exists with same name and address."));const r={id:this.makeId("prop"),name:e.name.trim(),city:e.city.trim(),address:e.address.trim(),description:e.description.trim(),ownerName:e.ownerName.trim(),status:e.status,units:[]},n=[r,...this.state$.value];return this.state$.next(n),this.writeMockStore(n),this.refresh.notifyPropertiesChanged(),(0,_.of)(r)}updateProperty(e){if(!d.N.api.useMockApi)return this.apiClient.put(m.P.properties.update(e.id),e);if(this.isDuplicateProperty(e,e.id))return(0,l._)(()=>new Error("Another property already exists with same name and address."));let r;const n=this.state$.value.map(o=>o.id!==e.id?o:(r={...o,name:e.name.trim(),city:e.city.trim(),address:e.address.trim(),description:e.description.trim(),ownerName:e.ownerName.trim(),status:e.status},r));return void 0===r?(0,l._)(()=>new Error("Property not found for update.")):(this.state$.next(n),this.writeMockStore(n),this.refresh.notifyPropertiesChanged(),(0,_.of)(r))}upsertUnit(e){if(!d.N.api.useMockApi)return e.id?this.apiClient.put(m.P.properties.updateUnit(e.propertyId,e.id),e):this.apiClient.post(m.P.properties.createUnit(e.propertyId),e);const r=this.state$.value.find(p=>p.id===e.propertyId);if(!r)return(0,l._)(()=>new Error("Property not found for unit operation."));if(this.isDuplicateUnitCode(r,e.unitCode,e.id))return(0,l._)(()=>new Error("Unit code already exists in this property."));const n=e.media.filter(p=>p.url.trim().length>0).map(p=>({...p,url:p.url.trim(),title:p.title.trim()})),o={id:e.id??this.makeId("unit"),unitCode:e.unitCode.trim(),configuration:e.configuration,type:e.configuration,furnishing:e.furnishing,rent:Number(e.rent)||0,occupancyStatus:e.occupancyStatus,tenantName:e.tenantName.trim(),carpetAreaSqFt:Number(e.carpetAreaSqFt)||0,parking:{twoWheelerSlots:Number(e.parking.twoWheelerSlots)||0,fourWheelerSlots:Number(e.parking.fourWheelerSlots)||0},utilities:{electricityProvider:e.utilities.electricityProvider.trim(),meterNumber:e.utilities.meterNumber.trim(),gasLine:e.utilities.gasLine,waterSupply:e.utilities.waterSupply},media:n},u=this.state$.value.map(p=>{if(p.id!==e.propertyId)return p;const g=p.units.findIndex(ot=>ot.id===o.id);if(-1===g)return{...p,units:[...p.units,o]};const x=[...p.units];return x[g]=o,{...p,units:x}});return this.state$.next(u),this.writeMockStore(u),this.refresh.notifyPropertiesChanged(),(0,_.of)(o)}isDuplicateProperty(e,r=""){const n=this.norm(e.name),o=this.norm(e.city),u=this.norm(e.address);return this.state$.value.some(p=>(!r||p.id!==r)&&this.norm(p.name)===n&&this.norm(p.city)===o&&this.norm(p.address)===u)}isDuplicateUnitCode(e,r,n=""){const o=this.norm(r);return e.units.some(u=>(!n||u.id!==n)&&this.norm(u.unitCode)===o)}norm(e){return(e??"").trim().toLowerCase()}normalizeProperties(e){return e.map(r=>({...r,address:r.address??"",description:r.description??"",units:(r.units??[]).map(n=>this.normalizeUnit(n))}))}normalizeUnit(e){const r=e.configuration??e.type??"1BHK",n=e.furnishing??"unfurnished";return{...e,configuration:r,type:e.type??r,furnishing:n,carpetAreaSqFt:Number(e.carpetAreaSqFt??0),parking:{twoWheelerSlots:Number(e.parking?.twoWheelerSlots??0),fourWheelerSlots:Number(e.parking?.fourWheelerSlots??0)},utilities:{electricityProvider:e.utilities?.electricityProvider??"",meterNumber:e.utilities?.meterNumber??"",gasLine:e.utilities?.gasLine??"no",waterSupply:e.utilities?.waterSupply??"corporation"},media:(e.media??[]).map((o,u)=>({id:o.id??`${e.id}-media-${u+1}`,type:o.type,url:o.url,title:o.title??""}))}}makeId(e){return`${e}-${Date.now()}-${Math.floor(1e3*Math.random())}`}readMockStore(){try{const e=localStorage.getItem(this.mockStoreKey);if(!e)return null;const r=JSON.parse(e);return Array.isArray(r)?r:null}catch{return null}}writeMockStore(e){if(d.N.api.useMockApi)try{localStorage.setItem(this.mockStoreKey,JSON.stringify(e))}catch{}}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(b.O),t.LFG(P.y))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var w=c(263),N=c(1438),Z=c(6895),F=c(9219),k=c(2802),S=c(5213),I=c(8821);function M(i,a){if(1&i&&(t.TgZ(0,"option",19),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function O(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",20)(1,"button",21),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.openCreateProperty())}),t._uU(2,"Add Property"),t.qZA()()}}function J(i,a){if(1&i&&(t.TgZ(0,"div",35),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Oqu(e.propertyFormError)}}function E(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"section",5)(1,"r360-card")(2,"div",22),t._uU(3),t.qZA(),t.TgZ(4,"form",23),t.NdJ("ngSubmit",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.submitProperty())}),t.TgZ(5,"label",8),t._uU(6," Property Name "),t._UZ(7,"input",24),t.qZA(),t.TgZ(8,"label",8),t._uU(9," City "),t._UZ(10,"input",25),t.qZA(),t.TgZ(11,"label",26),t._uU(12," Address "),t._UZ(13,"input",27),t.qZA(),t.TgZ(14,"label",26),t._uU(15," Description "),t._UZ(16,"textarea",28),t.qZA(),t.TgZ(17,"label",8),t._uU(18," Owner "),t._UZ(19,"input",29),t.qZA(),t.TgZ(20,"label",8),t._uU(21," Status "),t.TgZ(22,"select",30)(23,"option",13),t._uU(24,"Active"),t.qZA(),t.TgZ(25,"option",14),t._uU(26,"Inactive"),t.qZA()()(),t.YNc(27,J,2,1,"div",31),t.TgZ(28,"div",32)(29,"button",33),t._uU(30),t.qZA(),t.TgZ(31,"button",34),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.cancelPropertyForm())}),t._uU(32,"Cancel"),t.qZA()()()()()}if(2&i){const e=t.oxw();t.xp6(3),t.Oqu(e.editPropertyMode?"Update Property":"Create Property"),t.xp6(1),t.Q6J("formGroup",e.propertyForm),t.xp6(23),t.Q6J("ngIf",e.propertyFormError),t.xp6(2),t.Q6J("disabled",e.formSubmitting),t.xp6(1),t.Oqu(e.editPropertyMode?"Update":"Create")}}function $(i,a){if(1&i&&(t.TgZ(0,"option",19),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function L(i,a){if(1&i&&(t.TgZ(0,"option",19),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function W(i,a){if(1&i&&(t.TgZ(0,"div",63),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Oqu(e.unitFormError)}}function Q(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"section",5)(1,"r360-card")(2,"div",22),t._uU(3),t.qZA(),t.TgZ(4,"form",36),t.NdJ("ngSubmit",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.submitUnit())}),t.TgZ(5,"label",8),t._uU(6," Unit Code "),t._UZ(7,"input",37),t.qZA(),t.TgZ(8,"label",8),t._uU(9," BHK "),t.TgZ(10,"select",38),t.YNc(11,$,2,2,"option",11),t.qZA()(),t.TgZ(12,"label",8),t._uU(13," Furnishing "),t.TgZ(14,"select",39),t.YNc(15,L,2,2,"option",11),t.qZA()(),t.TgZ(16,"label",8),t._uU(17," Monthly Rent "),t._UZ(18,"input",40),t.qZA(),t.TgZ(19,"label",8),t._uU(20," Occupancy "),t.TgZ(21,"select",41)(22,"option",42),t._uU(23,"Occupied"),t.qZA(),t.TgZ(24,"option",43),t._uU(25,"Vacant"),t.qZA(),t.TgZ(26,"option",44),t._uU(27,"Maintenance"),t.qZA()()(),t.TgZ(28,"label",8),t._uU(29," Tenant Name "),t._UZ(30,"input",45),t.qZA(),t.TgZ(31,"label",8),t._uU(32," Carpet Area (sq.ft) "),t._UZ(33,"input",46),t.qZA(),t.TgZ(34,"label",8),t._uU(35," Two Wheeler Parking "),t._UZ(36,"input",47),t.qZA(),t.TgZ(37,"label",8),t._uU(38," Four Wheeler Parking "),t._UZ(39,"input",48),t.qZA(),t.TgZ(40,"label",8),t._uU(41," Electricity Provider "),t._UZ(42,"input",49),t.qZA(),t.TgZ(43,"label",8),t._uU(44," Electricity Meter No "),t._UZ(45,"input",50),t.qZA(),t.TgZ(46,"label",8),t._uU(47," Gas Line "),t.TgZ(48,"select",51)(49,"option",52),t._uU(50,"Yes"),t.qZA(),t.TgZ(51,"option",53),t._uU(52,"No"),t.qZA()()(),t.TgZ(53,"label",8),t._uU(54," Water Supply "),t.TgZ(55,"select",54)(56,"option",55),t._uU(57,"Corporation"),t.qZA(),t.TgZ(58,"option",56),t._uU(59,"Borewell"),t.qZA(),t.TgZ(60,"option",57),t._uU(61,"Mixed"),t.qZA()()(),t.TgZ(62,"label",58),t._uU(63," Image URL "),t._UZ(64,"input",59),t.qZA(),t.TgZ(65,"label",58),t._uU(66," Video URL "),t._UZ(67,"input",60),t.qZA(),t.YNc(68,W,2,1,"div",61),t.TgZ(69,"div",62)(70,"button",33),t._uU(71),t.qZA(),t.TgZ(72,"button",34),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.cancelUnitForm())}),t._uU(73,"Cancel"),t.qZA()()()()()}if(2&i){const e=t.oxw();t.xp6(3),t.Oqu(e.editUnitMode?"Update Unit Details":"Add Unit Details"),t.xp6(1),t.Q6J("formGroup",e.unitForm),t.xp6(7),t.Q6J("ngForOf",e.bhkOptions),t.xp6(4),t.Q6J("ngForOf",e.furnishingOptions),t.xp6(53),t.Q6J("ngIf",e.unitFormError),t.xp6(2),t.Q6J("disabled",e.formSubmitting),t.xp6(1),t.Oqu(e.editUnitMode?"Update Unit":"Create Unit")}}function K(i,a){if(1&i&&(t.TgZ(0,"div",67)(1,"div",68),t._uU(2,"Unit"),t.qZA(),t.TgZ(3,"div",69),t._uU(4),t.qZA(),t.TgZ(5,"div",76)(6,"div")(7,"span",73),t._uU(8,"Furnishing:"),t.qZA(),t._uU(9),t.qZA(),t.TgZ(10,"div")(11,"span",73),t._uU(12,"Carpet:"),t.qZA(),t._uU(13),t.qZA(),t.TgZ(14,"div")(15,"span",73),t._uU(16,"Rent:"),t.qZA(),t._uU(17),t.ALo(18,"appCurrency"),t.qZA(),t.TgZ(19,"div")(20,"span",73),t._uU(21,"Tenant:"),t.qZA(),t._uU(22),t.qZA(),t.TgZ(23,"div")(24,"span",73),t._uU(25,"2W Parking:"),t.qZA(),t._uU(26),t.qZA(),t.TgZ(27,"div")(28,"span",73),t._uU(29,"4W Parking:"),t.qZA(),t._uU(30),t.qZA(),t.TgZ(31,"div")(32,"span",73),t._uU(33,"Electricity:"),t.qZA(),t._uU(34),t.qZA(),t.TgZ(35,"div")(36,"span",73),t._uU(37,"Meter:"),t.qZA(),t._uU(38),t.qZA(),t.TgZ(39,"div")(40,"span",73),t._uU(41,"Gas Line:"),t.qZA(),t._uU(42),t.qZA(),t.TgZ(43,"div")(44,"span",73),t._uU(45,"Water:"),t.qZA(),t._uU(46),t.qZA()()()),2&i){const e=a.ngIf;t.xp6(4),t.AsE("",e.unitCode," \ufffd ",e.configuration,""),t.xp6(5),t.hij(" ",e.furnishing,""),t.xp6(4),t.hij(" ",e.carpetAreaSqFt," sq.ft"),t.xp6(4),t.hij(" ",t.lcZ(18,12,e.rent),""),t.xp6(5),t.hij(" ",e.tenantName||"-",""),t.xp6(4),t.hij(" ",e.parking.twoWheelerSlots,""),t.xp6(4),t.hij(" ",e.parking.fourWheelerSlots,""),t.xp6(4),t.hij(" ",e.utilities.electricityProvider,""),t.xp6(4),t.hij(" ",e.utilities.meterNumber,""),t.xp6(4),t.hij(" ",e.utilities.gasLine,""),t.xp6(4),t.hij(" ",e.utilities.waterSupply,"")}}function Y(i,a){if(1&i&&t._UZ(0,"img",83),2&i){const e=t.oxw().$implicit,r=t.oxw(2).ngIf;t.Q6J("src",e.url,t.LSH)("alt",e.title||r.propertyName)}}function j(i,a){if(1&i&&t._UZ(0,"video",84),2&i){const e=t.oxw().$implicit;t.Q6J("src",e.url,t.LSH)}}function D(i,a){if(1&i&&(t.TgZ(0,"div",79)(1,"div",80),t._uU(2),t.qZA(),t.YNc(3,Y,1,2,"img",81),t.YNc(4,j,1,1,"video",82),t.qZA()),2&i){const e=a.$implicit;t.xp6(2),t.Oqu(e.type),t.xp6(1),t.Q6J("ngIf","image"===e.type),t.xp6(1),t.Q6J("ngIf","video"===e.type)}}function H(i,a){if(1&i&&(t.TgZ(0,"div",77),t.YNc(1,D,5,3,"div",78),t.qZA()),2&i){const e=t.oxw().ngIf;t.xp6(1),t.Q6J("ngForOf",null==e.unit?null:e.unit.media)}}function B(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"section",5)(1,"r360-card")(2,"div",64)(3,"h3",65),t._uU(4,"Property & Unit Details"),t.qZA(),t.TgZ(5,"button",34),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.closeDetails())}),t._uU(6,"Close"),t.qZA()(),t.TgZ(7,"div",66)(8,"div",67)(9,"div",68),t._uU(10,"Property"),t.qZA(),t.TgZ(11,"div",69),t._uU(12),t.qZA(),t.TgZ(13,"div",70),t._uU(14),t.qZA(),t.TgZ(15,"div",70),t._uU(16),t.qZA(),t.TgZ(17,"div",71),t._uU(18),t.qZA(),t.TgZ(19,"div",72)(20,"span",73),t._uU(21,"Owner:"),t.qZA(),t._uU(22),t.qZA()(),t.YNc(23,K,47,14,"div",74),t.qZA(),t.YNc(24,H,2,1,"div",75),t.qZA()()}if(2&i){const e=a.ngIf;t.xp6(12),t.Oqu(e.propertyName),t.xp6(2),t.Oqu(e.address),t.xp6(2),t.Oqu(e.city),t.xp6(2),t.Oqu(e.description),t.xp6(4),t.hij(" ",e.ownerName,""),t.xp6(1),t.Q6J("ngIf",e.unit),t.xp6(1),t.Q6J("ngIf",null==e.unit||null==e.unit.media?null:e.unit.media.length)}}function G(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",20)(1,"button",34),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw(2);return t.KtG(o.openEditProperty(n))}),t._uU(2,"Edit Property"),t.qZA(),t.TgZ(3,"button",21),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw(2);return t.KtG(o.openCreateUnit(n.id))}),t._uU(4,"Add Unit"),t.qZA()()}}function z(i,a){1&i&&(t.TgZ(0,"tr",96)(1,"td",97),t._uU(2,"No units found for this property."),t.qZA()())}function R(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",107),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2).$implicit,o=t.oxw().$implicit,u=t.oxw(2);return t.KtG(u.openEditUnit(o,n))}),t._uU(1,"Edit Unit"),t.qZA()}}function V(i,a){if(1&i){const e=t.EpF();t.O4$(),t.kcU(),t.TgZ(0,"div",106)(1,"button",107),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw().$implicit,u=t.oxw(2);return t.KtG(u.viewPropertyUnitDetails(o,n))}),t._uU(2,"View"),t.qZA(),t.YNc(3,R,2,0,"button",108),t.qZA()}if(2&i){const e=t.oxw(4);t.xp6(3),t.Q6J("ngIf",e.canEdit)}}function X(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"tr",96)(1,"td",98),t._uU(2),t.qZA(),t.TgZ(3,"td",98),t._uU(4),t.qZA(),t.TgZ(5,"td",98),t._uU(6),t.qZA(),t.TgZ(7,"td",98),t._uU(8),t.ALo(9,"appCurrency"),t.qZA(),t.TgZ(10,"td",98),t._uU(11),t.qZA(),t.TgZ(12,"td",98),t._uU(13),t.qZA(),t.TgZ(14,"td",98),t._uU(15),t.qZA(),t.TgZ(16,"td",98),t._uU(17),t.qZA(),t.TgZ(18,"td",98),t._UZ(19,"r360-status-badge",19),t.qZA(),t.TgZ(20,"td",98)(21,"div",99),t.NdJ("click",function(n){return n.stopPropagation()}),t.TgZ(22,"button",100),t.NdJ("click",function(n){const u=t.CHM(e).$implicit,p=t.oxw().$implicit,g=t.oxw(2);return t.KtG(g.toggleActionMenu(n,p.id,u.id))}),t.O4$(),t.TgZ(23,"svg",101),t._UZ(24,"circle",102)(25,"circle",103)(26,"circle",104),t.qZA()(),t.YNc(27,V,4,1,"div",105),t.qZA()()()}if(2&i){const e=a.$implicit,r=t.oxw().$implicit,n=t.oxw(2);t.xp6(2),t.Oqu(e.unitCode),t.xp6(2),t.Oqu(e.configuration),t.xp6(2),t.Oqu(e.furnishing),t.xp6(2),t.Oqu(t.lcZ(9,12,e.rent)),t.xp6(3),t.hij("",e.carpetAreaSqFt," sq.ft"),t.xp6(2),t.AsE("",e.parking.twoWheelerSlots," / ",e.parking.fourWheelerSlots,""),t.xp6(2),t.AsE("",e.utilities.electricityProvider," \ufffd ",e.utilities.gasLine,""),t.xp6(2),t.Oqu(e.media.length),t.xp6(2),t.Q6J("value",e.occupancyStatus),t.xp6(8),t.Q6J("ngIf",n.isActionMenuOpen(r.id,e.id))}}function tt(i,a){if(1&i&&(t.TgZ(0,"r360-card")(1,"div",87)(2,"div")(3,"h3",88),t._uU(4),t.qZA(),t.TgZ(5,"p",89),t._uU(6),t.qZA(),t.TgZ(7,"p",70),t._uU(8),t.qZA(),t.TgZ(9,"p",70),t._uU(10),t.qZA()(),t.YNc(11,G,5,0,"div",15),t.qZA(),t.TgZ(12,"div",90)(13,"table",91)(14,"thead")(15,"tr",92)(16,"th",93),t._uU(17,"Unit"),t.qZA(),t.TgZ(18,"th",93),t._uU(19,"BHK"),t.qZA(),t.TgZ(20,"th",93),t._uU(21,"Furnishing"),t.qZA(),t.TgZ(22,"th",93),t._uU(23,"Rent"),t.qZA(),t.TgZ(24,"th",93),t._uU(25,"Carpet"),t.qZA(),t.TgZ(26,"th",93),t._uU(27,"Parking"),t.qZA(),t.TgZ(28,"th",93),t._uU(29,"Utilities"),t.qZA(),t.TgZ(30,"th",93),t._uU(31,"Media"),t.qZA(),t.TgZ(32,"th",93),t._uU(33,"Status"),t.qZA(),t.TgZ(34,"th",93),t._uU(35,"Actions"),t.qZA()()(),t.TgZ(36,"tbody"),t.YNc(37,z,3,0,"tr",94),t.YNc(38,X,28,14,"tr",95),t.qZA()()()()),2&i){const e=a.$implicit,r=t.oxw(2);t.xp6(4),t.Oqu(e.name),t.xp6(2),t.AsE("",e.address," \ufffd ",e.city,""),t.xp6(2),t.hij("Owner: ",e.ownerName,""),t.xp6(2),t.Oqu(e.description),t.xp6(1),t.Q6J("ngIf",r.canEdit),t.xp6(26),t.Q6J("ngIf",!e.units.length),t.xp6(1),t.Q6J("ngForOf",e.units)}}function et(i,a){if(1&i&&(t.TgZ(0,"div",85),t.YNc(1,tt,39,8,"r360-card",86),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.filteredProperties)}}function rt(i,a){1&i&&(t.TgZ(0,"r360-card")(1,"p",109),t._uU(2,"No property records match your filters."),t.qZA()())}const it=[{path:"",component:(()=>{class i{constructor(e,r,n,o){this.fb=e,this.propertiesData=r,this.auth=n,this.authorization=o,this.properties=[],this.filteredProperties=[],this.search="",this.selectedProperty="All",this.selectedStatus="All",this.showPropertyForm=!1,this.showUnitForm=!1,this.editPropertyMode=!1,this.editUnitMode=!1,this.editingPropertyId="",this.editingUnitId="",this.selectedRow=null,this.formSubmitting=!1,this.propertyFormError="",this.unitFormError="",this.openActionMenuId=null,this.bhkOptions=["studio","1BHK","2BHK","3BHK","4BHK","5BHK+"],this.furnishingOptions=["unfurnished","semi-furnished","furnished"],this.propertyForm=this.fb.group({name:["",[s.kI.required,s.kI.minLength(2)]],city:["",[s.kI.required,s.kI.minLength(2)]],address:["",[s.kI.required,s.kI.minLength(5)]],description:["",[s.kI.required,s.kI.minLength(5)]],ownerName:["",[s.kI.required,s.kI.minLength(2)]],status:["active",s.kI.required]}),this.unitForm=this.fb.group({propertyId:["",s.kI.required],unitCode:["",[s.kI.required,s.kI.minLength(2)]],configuration:["1BHK",s.kI.required],furnishing:["unfurnished",s.kI.required],rent:[0,[s.kI.required,s.kI.min(0)]],occupancyStatus:["vacant",s.kI.required],tenantName:[""],carpetAreaSqFt:[0,[s.kI.required,s.kI.min(0)]],parkingTwoWheeler:[0,[s.kI.required,s.kI.min(0)]],parkingFourWheeler:[0,[s.kI.required,s.kI.min(0)]],electricityProvider:["",s.kI.required],meterNumber:["",s.kI.required],gasLine:["yes",s.kI.required],waterSupply:["corporation",s.kI.required],imageUrl:[""],videoUrl:[""]})}ngOnInit(){this.propertiesData.getProperties().subscribe(e=>{this.properties=e,this.applyFilters()})}get canEdit(){return this.authorization.canWrite(y._.propertiesWrite)}get propertyOptions(){return["All",...this.properties.map(e=>e.name)]}get totalProperties(){return this.properties.length}get totalUnits(){return this.properties.reduce((e,r)=>e+r.units.length,0)}get occupiedUnits(){return this.properties.flatMap(e=>e.units).filter(e=>"occupied"===e.occupancyStatus).length}get vacantUnits(){return this.properties.flatMap(e=>e.units).filter(e=>"vacant"===e.occupancyStatus).length}onSearch(e){this.search=e,this.applyFilters()}onPropertyFilter(e){this.selectedProperty=e,this.applyFilters()}onStatusFilter(e){this.selectedStatus=e,this.applyFilters()}rowMenuId(e,r){return`${e}-${r??"no-unit"}`}toggleActionMenu(e,r,n){e.stopPropagation();const o=this.rowMenuId(r,n);this.openActionMenuId=this.openActionMenuId===o?null:o}isActionMenuOpen(e,r){return this.openActionMenuId===this.rowMenuId(e,r)}closeActionMenu(){this.openActionMenuId=null}onDocumentClick(){this.closeActionMenu()}openCreateProperty(){this.propertyFormError="",this.editPropertyMode=!1,this.editingPropertyId="",this.propertyForm.reset({name:"",city:"",address:"",description:"",ownerName:this.auth.snapshotUser?.fullName??"",status:"active"}),this.showPropertyForm=!0}openEditProperty(e){this.propertyFormError="",this.editPropertyMode=!0,this.editingPropertyId=e.id,this.propertyForm.reset({name:e.name,city:e.city,address:e.address,description:e.description,ownerName:e.ownerName,status:e.status}),this.showPropertyForm=!0}openCreateUnit(e){this.unitFormError="",this.editUnitMode=!1,this.editingUnitId="",this.unitForm.reset({propertyId:e,unitCode:"",configuration:"1BHK",furnishing:"unfurnished",rent:0,occupancyStatus:"vacant",tenantName:"",carpetAreaSqFt:0,parkingTwoWheeler:0,parkingFourWheeler:0,electricityProvider:"",meterNumber:"",gasLine:"yes",waterSupply:"corporation",imageUrl:"",videoUrl:""}),this.showUnitForm=!0}openEditUnit(e,r){this.unitFormError="";const n=r.media.find(u=>"image"===u.type)?.url??"",o=r.media.find(u=>"video"===u.type)?.url??"";this.editUnitMode=!0,this.editingUnitId=r.id,this.unitForm.reset({propertyId:e.id,unitCode:r.unitCode,configuration:r.configuration,furnishing:r.furnishing,rent:r.rent,occupancyStatus:r.occupancyStatus,tenantName:r.tenantName,carpetAreaSqFt:r.carpetAreaSqFt,parkingTwoWheeler:r.parking.twoWheelerSlots,parkingFourWheeler:r.parking.fourWheelerSlots,electricityProvider:r.utilities.electricityProvider,meterNumber:r.utilities.meterNumber,gasLine:r.utilities.gasLine,waterSupply:r.utilities.waterSupply,imageUrl:n,videoUrl:o}),this.showUnitForm=!0}viewPropertyUnitDetails(e,r){this.closeActionMenu(),this.selectedRow={propertyId:e.id,propertyName:e.name,propertyStatus:e.status,city:e.city,address:e.address,description:e.description,ownerName:e.ownerName,unit:r}}closeDetails(){this.selectedRow=null}cancelPropertyForm(){this.showPropertyForm=!1,this.propertyFormError="",this.formSubmitting=!1}cancelUnitForm(){this.showUnitForm=!1,this.unitFormError="",this.formSubmitting=!1}submitProperty(){if(this.propertyForm.invalid||this.formSubmitting)return void this.propertyForm.markAllAsTouched();this.propertyFormError="";const e=this.propertyForm.getRawValue();this.formSubmitting=!0,(this.editPropertyMode?this.propertiesData.updateProperty({...e,id:this.editingPropertyId}):this.propertiesData.createProperty(e)).subscribe({next:()=>{this.formSubmitting=!1,this.showPropertyForm=!1,this.applyFilters()},error:n=>{this.formSubmitting=!1,this.propertyFormError=n instanceof Error?n.message:"Failed to save property."}})}submitUnit(){if(this.unitForm.invalid||this.formSubmitting)return void this.unitForm.markAllAsTouched();this.unitFormError="";const e=this.unitForm.getRawValue(),r=(e.imageUrl??"").trim(),n=(e.videoUrl??"").trim(),o=[{id:`${e.propertyId}-image`,type:"image",url:r,title:"Unit image"},{id:`${e.propertyId}-video`,type:"video",url:n,title:"Unit video"}].filter(p=>!!p.url),u={id:this.editUnitMode?this.editingUnitId:void 0,propertyId:e.propertyId??"",unitCode:e.unitCode??"",configuration:e.configuration??"1BHK",furnishing:e.furnishing??"unfurnished",rent:Number(e.rent)||0,occupancyStatus:e.occupancyStatus??"vacant",tenantName:e.tenantName??"",carpetAreaSqFt:Number(e.carpetAreaSqFt)||0,parking:{twoWheelerSlots:Number(e.parkingTwoWheeler)||0,fourWheelerSlots:Number(e.parkingFourWheeler)||0},utilities:{electricityProvider:e.electricityProvider??"",meterNumber:e.meterNumber??"",gasLine:e.gasLine??"yes",waterSupply:e.waterSupply??"corporation"},media:o};this.formSubmitting=!0,this.propertiesData.upsertUnit(u).subscribe({next:()=>{this.formSubmitting=!1,this.showUnitForm=!1,this.applyFilters()},error:p=>{this.formSubmitting=!1,this.unitFormError=p instanceof Error?p.message:"Failed to save unit."}})}applyFilters(){const e=this.search.trim().toLowerCase();this.filteredProperties=this.properties.filter(r=>"All"===this.selectedProperty||r.name===this.selectedProperty).filter(r=>"All"===this.selectedStatus||r.status===this.selectedStatus).map(r=>{if(!e||[r.name,r.city,r.address,r.description,r.ownerName].join(" ").toLowerCase().includes(e))return r;const o=r.units.filter(u=>[u.unitCode,u.configuration,u.furnishing,u.tenantName,u.utilities.electricityProvider,u.utilities.meterNumber].join(" ").toLowerCase().includes(e));return{...r,units:o}}).filter(r=>r.units.length>0||""===this.search.trim()||[r.name,r.city,r.address,r.description,r.ownerName].join(" ").toLowerCase().includes(e))}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(s.qu),t.Y36(C),t.Y36(w.e),t.Y36(N.Z))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-properties"]],hostBindings:function(e,r){1&e&&t.NdJ("click",function(){return r.onDocumentClick()},!1,t.evT)},decls:51,vars:14,consts:[[1,"r360-page"],["title","Properties & Units","subtitle","Property-wise listing with unit details, media, utilities and parking"],[1,"r360-section","grid","grid-cols-1","gap-4","sm:grid-cols-2","xl:grid-cols-4"],[1,"text-xs","uppercase","tracking-wide","text-gray-500"],[1,"mt-2","text-3xl","font-bold","text-gray-900","dark:text-gray-100"],[1,"r360-section"],[1,"flex","flex-col","gap-3","lg:flex-row","lg:items-end","lg:justify-between"],[1,"grid","grid-cols-1","gap-3","sm:grid-cols-3","lg:min-w-[620px]","lg:flex-1"],[1,"r360-label"],["type","text","placeholder","Property, unit, BHK, furnishing, utility",1,"r360-input","mt-1",3,"value","input"],[1,"r360-input","mt-1",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],["value","All"],["value","active"],["value","inactive"],["class","flex items-center gap-2",4,"ngIf"],["class","r360-section",4,"ngIf"],["class","space-y-4",4,"ngIf","ngIfElse"],["noPropertyData",""],[3,"value"],[1,"flex","items-center","gap-2"],["type","button",1,"r360-btn-primary",3,"click"],[1,"mb-4","text-lg","font-semibold"],[1,"grid","grid-cols-1","gap-3","sm:grid-cols-2",3,"formGroup","ngSubmit"],["type","text","formControlName","name","placeholder","e.g. Palm Residency",1,"r360-input","mt-1"],["type","text","formControlName","city","placeholder","e.g. Austin",1,"r360-input","mt-1"],[1,"r360-label","sm:col-span-2"],["type","text","formControlName","address","placeholder","Street, area, city, zip",1,"r360-input","mt-1"],["formControlName","description","placeholder","Mention highlights like gated community, amenities, nearby access",1,"r360-input","mt-1","min-h-[88px]"],["type","text","formControlName","ownerName","placeholder","Owner full name",1,"r360-input","mt-1"],["formControlName","status",1,"r360-input","mt-1"],["class","sm:col-span-2 text-sm text-danger",4,"ngIf"],[1,"sm:col-span-2","flex","flex-wrap","gap-2","pt-2"],["type","submit",1,"r360-btn-primary",3,"disabled"],["type","button",1,"r360-btn-secondary",3,"click"],[1,"sm:col-span-2","text-sm","text-danger"],[1,"grid","grid-cols-1","gap-3","sm:grid-cols-2","xl:grid-cols-3",3,"formGroup","ngSubmit"],["type","text","formControlName","unitCode","placeholder","A-101",1,"r360-input","mt-1"],["formControlName","configuration",1,"r360-input","mt-1"],["formControlName","furnishing",1,"r360-input","mt-1"],["type","number","formControlName","rent",1,"r360-input","mt-1"],["formControlName","occupancyStatus",1,"r360-input","mt-1"],["value","occupied"],["value","vacant"],["value","maintenance"],["type","text","formControlName","tenantName","placeholder","Tenant full name",1,"r360-input","mt-1"],["type","number","formControlName","carpetAreaSqFt",1,"r360-input","mt-1"],["type","number","formControlName","parkingTwoWheeler",1,"r360-input","mt-1"],["type","number","formControlName","parkingFourWheeler",1,"r360-input","mt-1"],["type","text","formControlName","electricityProvider","placeholder","City Power",1,"r360-input","mt-1"],["type","text","formControlName","meterNumber","placeholder","MTR-12345",1,"r360-input","mt-1"],["formControlName","gasLine",1,"r360-input","mt-1"],["value","yes"],["value","no"],["formControlName","waterSupply",1,"r360-input","mt-1"],["value","corporation"],["value","borewell"],["value","mixed"],[1,"r360-label","xl:col-span-2"],["type","text","formControlName","imageUrl","placeholder","https://...jpg",1,"r360-input","mt-1"],["type","text","formControlName","videoUrl","placeholder","https://...mp4",1,"r360-input","mt-1"],["class","xl:col-span-3 text-sm text-danger",4,"ngIf"],[1,"xl:col-span-3","flex","flex-wrap","gap-2","pt-2"],[1,"xl:col-span-3","text-sm","text-danger"],[1,"mb-4","flex","items-center","justify-between"],[1,"text-lg","font-semibold"],[1,"grid","grid-cols-1","gap-4","lg:grid-cols-2"],[1,"r360-panel"],[1,"text-xs","uppercase","text-gray-500"],[1,"mt-2","text-lg","font-semibold","text-gray-900","dark:text-gray-100"],[1,"mt-1","text-sm","text-gray-600","dark:text-gray-300"],[1,"mt-2","text-sm","text-gray-700","dark:text-gray-200"],[1,"mt-3","text-sm"],[1,"font-semibold"],["class","r360-panel",4,"ngIf"],["class","mt-4 grid grid-cols-1 gap-4 lg:grid-cols-2",4,"ngIf"],[1,"mt-2","grid","grid-cols-2","gap-2","text-sm","text-gray-700","dark:text-gray-200"],[1,"mt-4","grid","grid-cols-1","gap-4","lg:grid-cols-2"],["class","rounded-xl border border-gray-200 p-3 dark:border-gray-700",4,"ngFor","ngForOf"],[1,"rounded-xl","border","border-gray-200","p-3","dark:border-gray-700"],[1,"mb-2","text-xs","uppercase","text-gray-500"],["class","h-44 w-full rounded-lg object-cover",3,"src","alt",4,"ngIf"],["controls","","class","h-44 w-full rounded-lg object-cover bg-black",3,"src",4,"ngIf"],[1,"h-44","w-full","rounded-lg","object-cover",3,"src","alt"],["controls","",1,"h-44","w-full","rounded-lg","object-cover","bg-black",3,"src"],[1,"space-y-4"],[4,"ngFor","ngForOf"],[1,"mb-4","flex","flex-col","gap-3","sm:flex-row","sm:items-start","sm:justify-between"],[1,"text-xl","font-semibold","text-gray-900","dark:text-gray-100"],[1,"text-sm","text-gray-500","dark:text-gray-300"],[1,"r360-table-wrap"],[1,"r360-table"],[1,"border-b","border-gray-200","dark:border-gray-700"],[1,"r360-th"],["class","r360-row",4,"ngIf"],["class","r360-row",4,"ngFor","ngForOf"],[1,"r360-row"],["colspan","10",1,"r360-td"],[1,"r360-td"],[1,"relative","inline-block","text-left",3,"click"],["type","button","aria-label","More actions",1,"r360-icon-btn",3,"click"],["viewBox","0 0 24 24",1,"h-5","w-5","fill-current"],["cx","12","cy","5","r","1.8"],["cx","12","cy","12","r","1.8"],["cx","12","cy","19","r","1.8"],["class","r360-menu",4,"ngIf"],[1,"r360-menu"],["type","button",1,"r360-menu-item",3,"click"],["class","r360-menu-item","type","button",3,"click",4,"ngIf"],[1,"text-sm","text-gray-500"]],template:function(e,r){if(1&e&&(t.TgZ(0,"div",0),t._UZ(1,"r360-page-header",1),t.TgZ(2,"section",2)(3,"r360-card")(4,"div",3),t._uU(5,"Total Properties"),t.qZA(),t.TgZ(6,"div",4),t._uU(7),t.qZA()(),t.TgZ(8,"r360-card")(9,"div",3),t._uU(10,"Total Units"),t.qZA(),t.TgZ(11,"div",4),t._uU(12),t.qZA()(),t.TgZ(13,"r360-card")(14,"div",3),t._uU(15,"Occupied Units"),t.qZA(),t.TgZ(16,"div",4),t._uU(17),t.qZA()(),t.TgZ(18,"r360-card")(19,"div",3),t._uU(20,"Vacant Units"),t.qZA(),t.TgZ(21,"div",4),t._uU(22),t.qZA()()(),t.TgZ(23,"section",5)(24,"r360-card")(25,"div",6)(26,"div",7)(27,"label",8),t._uU(28," Search "),t.TgZ(29,"input",9),t.NdJ("input",function(o){return r.onSearch(o.target.value)}),t.qZA()(),t.TgZ(30,"label",8),t._uU(31," Property "),t.TgZ(32,"select",10),t.NdJ("change",function(o){return r.onPropertyFilter(o.target.value)}),t.YNc(33,M,2,2,"option",11),t.qZA()(),t.TgZ(34,"label",8),t._uU(35," Status "),t.TgZ(36,"select",10),t.NdJ("change",function(o){return r.onStatusFilter(o.target.value)}),t.TgZ(37,"option",12),t._uU(38,"All"),t.qZA(),t.TgZ(39,"option",13),t._uU(40,"Active"),t.qZA(),t.TgZ(41,"option",14),t._uU(42,"Inactive"),t.qZA()()()(),t.YNc(43,O,3,0,"div",15),t.qZA()()(),t.YNc(44,E,33,5,"section",16),t.YNc(45,Q,74,7,"section",16),t.YNc(46,B,25,7,"section",16),t.TgZ(47,"section",5),t.YNc(48,et,2,1,"div",17),t.YNc(49,rt,3,0,"ng-template",null,18,t.W1O),t.qZA()()),2&e){const n=t.MAs(50);t.xp6(7),t.Oqu(r.totalProperties),t.xp6(5),t.Oqu(r.totalUnits),t.xp6(5),t.Oqu(r.occupiedUnits),t.xp6(5),t.Oqu(r.vacantUnits),t.xp6(7),t.Q6J("value",r.search),t.xp6(3),t.Q6J("value",r.selectedProperty),t.xp6(1),t.Q6J("ngForOf",r.propertyOptions),t.xp6(3),t.Q6J("value",r.selectedStatus),t.xp6(7),t.Q6J("ngIf",r.canEdit),t.xp6(1),t.Q6J("ngIf",r.showPropertyForm&&r.canEdit),t.xp6(1),t.Q6J("ngIf",r.showUnitForm&&r.canEdit),t.xp6(1),t.Q6J("ngIf",r.selectedRow),t.xp6(2),t.Q6J("ngIf",r.filteredProperties.length)("ngIfElse",n)}},dependencies:[Z.sg,Z.O5,s._Y,s.YN,s.Kr,s.Fj,s.wV,s.EJ,s.JJ,s.JL,s.sg,s.u,F.A,k.q,S.e,I.I]}),i})()}];let nt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[U.m,v.Bz.forChild(it)]}),i})()}}]);