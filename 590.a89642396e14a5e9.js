"use strict";(self.webpackChunkrent360=self.webpackChunkrent360||[]).push([[590],{7590:(W,u,c)=>{c.r(u),c.d(u,{DashboardModule:()=>K});var _=c(4466),g=c(5675),b=c(727),t=c(8256),f=c(8700),Z=c(7338),x=c(263),T=c(1312),l=c(6895),p=c(4006),q=c(9219);const v=["*"];let A=(()=>{class n{constructor(){this.columns=[]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["r360-table"]],inputs:{columns:"columns"},ngContentSelectors:v,decls:3,vars:0,consts:[[1,"r360-table-wrap"],[1,"r360-table"]],template:function(e,a){1&e&&(t.F$t(),t.TgZ(0,"div",0)(1,"table",1),t.Hsn(2),t.qZA()())},encapsulation:2}),n})(),y=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["r360-pagination"]],decls:7,vars:0,consts:[[1,"flex","items-center","gap-2"],[1,"r360-btn-secondary"],[1,"text-sm","text-gray-600","dark:text-gray-300"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t._uU(2,"Prev"),t.qZA(),t.TgZ(3,"span",2),t._uU(4,"Page 1"),t.qZA(),t.TgZ(5,"button",1),t._uU(6,"Next"),t.qZA()())},encapsulation:2}),n})();var O=c(2802),U=c(5213);function w(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){const s=t.CHM(e).$implicit,d=t.oxw(3);return t.KtG(d.selectPersona(s))}),t._uU(1),t.qZA()}if(2&n){const e=r.$implicit,a=t.oxw(3);t.Q6J("ngClass",a.selectedPersona===e?"r360-chip-active":""),t.xp6(1),t.hij(" ",a.personaLabel(e)," ")}}function C(n,r){if(1&n&&(t.TgZ(0,"div",24),t.YNc(1,w,2,2,"button",25),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.availablePersonas)}}function P(n,r){if(1&n&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&n){const e=r.$implicit;t.Q6J("value",e.value),t.xp6(1),t.Oqu(e.label)}}function M(n,r){if(1&n&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&n){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function D(n,r){if(1&n&&(t.TgZ(0,"r360-card",28)(1,"div",29),t._uU(2),t.qZA(),t.TgZ(3,"div",30),t._uU(4),t.qZA()()),2&n){const e=r.$implicit,a=t.oxw(2);t.xp6(2),t.Oqu(e.label),t.xp6(2),t.Oqu(a.formatMetric(e.value))}}function F(n,r){if(1&n&&(t.TgZ(0,"div",43)(1,"span",44),t._uU(2),t.qZA(),t.TgZ(3,"span",45),t._uU(4),t.qZA()()),2&n){const e=r.$implicit,a=t.oxw(3);t.xp6(2),t.Oqu(e.label),t.xp6(2),t.Oqu(a.formatMetric(e.value))}}function N(n,r){if(1&n&&(t.TgZ(0,"div",43)(1,"span",44),t._uU(2),t.qZA(),t.TgZ(3,"span",45),t._uU(4),t.qZA()()),2&n){const e=r.$implicit,a=t.oxw(3);t.xp6(2),t.Oqu(e.label),t.xp6(2),t.Oqu(a.formatMetric(e.value))}}function k(n,r){if(1&n&&(t.TgZ(0,"div",43)(1,"span",44),t._uU(2),t.qZA(),t.TgZ(3,"span",45),t._uU(4),t.qZA()()),2&n){const e=r.$implicit,a=t.oxw(3);t.xp6(2),t.Oqu(e.label),t.xp6(2),t.Oqu(a.formatMetric(e.value))}}function J(n,r){if(1&n&&(t.TgZ(0,"tr",46)(1,"td",47),t._uU(2),t.qZA(),t.TgZ(3,"td",47),t._uU(4),t.qZA(),t.TgZ(5,"td",47),t._uU(6),t.qZA(),t.TgZ(7,"td",47),t._uU(8),t.qZA(),t.TgZ(9,"td",47),t._UZ(10,"r360-status-badge",27),t.qZA(),t.TgZ(11,"td",47)(12,"button",48),t._uU(13,"Send msg"),t.qZA()()()),2&n){const e=r.$implicit;t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.role),t.xp6(2),t.Oqu(e.property),t.xp6(2),t.Oqu(e.unit),t.xp6(2),t.Q6J("value",e.status)}}function Y(n,r){if(1&n&&(t.TgZ(0,"tr",46)(1,"td",47),t._uU(2),t.qZA(),t.TgZ(3,"td",47),t._uU(4),t.qZA(),t.TgZ(5,"td",47),t._uU(6),t.qZA(),t.TgZ(7,"td",49),t._uU(8),t.qZA(),t.TgZ(9,"td",50),t._uU(10),t.qZA(),t.TgZ(11,"td",47),t._uU(12),t.qZA()()),2&n){const e=r.$implicit,a=t.oxw(3);t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.property),t.xp6(2),t.Oqu(e.unit),t.xp6(2),t.Oqu(a.formatMetric(e.rentDue)),t.xp6(2),t.Oqu(a.formatMetric(e.maintenanceDue)),t.xp6(2),t.Oqu(e.daysLate)}}function Q(n,r){if(1&n&&(t.TgZ(0,"tr",46)(1,"td",47),t._uU(2),t.qZA(),t.TgZ(3,"td",47),t._uU(4),t.qZA(),t.TgZ(5,"td",47),t._uU(6),t.qZA(),t.TgZ(7,"td",47),t._uU(8),t.qZA(),t.TgZ(9,"td",47),t._uU(10),t.qZA(),t.TgZ(11,"td",47),t._uU(12),t.qZA(),t.TgZ(13,"td",47),t._uU(14),t.qZA()()),2&n){const e=r.$implicit;t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.role),t.xp6(2),t.Oqu(e.property),t.xp6(2),t.Oqu(e.unit),t.xp6(2),t.Oqu(e.from),t.xp6(2),t.Oqu(e.to),t.xp6(2),t.Oqu(e.moveOutReason)}}function I(n,r){if(1&n&&(t.TgZ(0,"section",18)(1,"h3",31),t._uU(2,"Society Admin Combined View"),t.qZA(),t.TgZ(3,"div",32)(4,"r360-card")(5,"div",33),t._uU(6,"Owner Insights"),t.qZA(),t.TgZ(7,"div",34),t.YNc(8,F,5,2,"div",35),t.qZA()(),t.TgZ(9,"r360-card")(10,"div",33),t._uU(11,"Tenant Insights"),t.qZA(),t.TgZ(12,"div",34),t.YNc(13,N,5,2,"div",35),t.qZA()(),t.TgZ(14,"r360-card")(15,"div",33),t._uU(16,"Maintenance & Meetings"),t.qZA(),t.TgZ(17,"div",34),t.YNc(18,k,5,2,"div",35),t.qZA()()(),t.TgZ(19,"div",36)(20,"r360-card")(21,"div",37)(22,"h4",38),t._uU(23,"Owner / Tenant / Member Directory"),t.qZA(),t.TgZ(24,"span",39),t._uU(25,"Status + quick action"),t.qZA()(),t.TgZ(26,"r360-table")(27,"thead")(28,"tr",40)(29,"th",41),t._uU(30,"Name"),t.qZA(),t.TgZ(31,"th",41),t._uU(32,"Role"),t.qZA(),t.TgZ(33,"th",41),t._uU(34,"Property"),t.qZA(),t.TgZ(35,"th",41),t._uU(36,"Unit"),t.qZA(),t.TgZ(37,"th",41),t._uU(38,"Status"),t.qZA(),t.TgZ(39,"th",41),t._uU(40,"Action"),t.qZA()()(),t.TgZ(41,"tbody"),t.YNc(42,J,14,5,"tr",42),t.qZA()()(),t.TgZ(43,"r360-card")(44,"div",37)(45,"h4",38),t._uU(46,"Rent + Maintenance Defaulters"),t.qZA(),t.TgZ(47,"span",39),t._uU(48,"Not paid amount and late days"),t.qZA()(),t.TgZ(49,"r360-table")(50,"thead")(51,"tr",40)(52,"th",41),t._uU(53,"Name"),t.qZA(),t.TgZ(54,"th",41),t._uU(55,"Property"),t.qZA(),t.TgZ(56,"th",41),t._uU(57,"Unit"),t.qZA(),t.TgZ(58,"th",41),t._uU(59,"Rent Due"),t.qZA(),t.TgZ(60,"th",41),t._uU(61,"Maintenance Due"),t.qZA(),t.TgZ(62,"th",41),t._uU(63,"Days Late"),t.qZA()()(),t.TgZ(64,"tbody"),t.YNc(65,Y,13,6,"tr",42),t.qZA()()(),t.TgZ(66,"r360-card")(67,"div",37)(68,"h4",38),t._uU(69,"Historical Owner / Tenant Records"),t.qZA(),t.TgZ(70,"span",39),t._uU(71,"Retained in system, not removed"),t.qZA()(),t.TgZ(72,"r360-table")(73,"thead")(74,"tr",40)(75,"th",41),t._uU(76,"Name"),t.qZA(),t.TgZ(77,"th",41),t._uU(78,"Role"),t.qZA(),t.TgZ(79,"th",41),t._uU(80,"Property"),t.qZA(),t.TgZ(81,"th",41),t._uU(82,"Unit"),t.qZA(),t.TgZ(83,"th",41),t._uU(84,"From"),t.qZA(),t.TgZ(85,"th",41),t._uU(86,"To"),t.qZA(),t.TgZ(87,"th",41),t._uU(88,"Reason"),t.qZA()()(),t.TgZ(89,"tbody"),t.YNc(90,Q,15,7,"tr",42),t.qZA()()()()()),2&n){const e=t.oxw().ngIf;t.xp6(8),t.Q6J("ngForOf",e.adminView.ownerInsights),t.xp6(5),t.Q6J("ngForOf",e.adminView.tenantInsights),t.xp6(5),t.Q6J("ngForOf",e.adminView.operationsInsights),t.xp6(24),t.Q6J("ngForOf",e.adminView.directory),t.xp6(23),t.Q6J("ngForOf",e.adminView.defaulters),t.xp6(25),t.Q6J("ngForOf",e.adminView.history)}}function S(n,r){if(1&n&&(t.TgZ(0,"r360-card",28)(1,"div",52),t._uU(2),t.qZA(),t.TgZ(3,"div",53),t._uU(4),t.qZA(),t.TgZ(5,"p",54),t._uU(6),t.qZA()()),2&n){const e=r.$implicit,a=t.oxw(3);t.xp6(2),t.Oqu(e.title),t.xp6(2),t.Oqu(a.formatMetric(e.value)),t.xp6(2),t.Oqu(e.description)}}function V(n,r){if(1&n&&(t.TgZ(0,"section",18)(1,"h3",31),t._uU(2,"Cross-Module Intelligence"),t.qZA(),t.TgZ(3,"div",51),t.YNc(4,S,7,3,"r360-card",21),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(4),t.Q6J("ngForOf",e.insights)}}const h=function(n,r,e,a,o){return[n,r,e,a,o]};function $(n,r){if(1&n&&(t.TgZ(0,"div",62)(1,"div",63)(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"span"),t._uU(5),t.qZA()(),t.TgZ(6,"div",64),t._UZ(7,"div",65),t.qZA()()),2&n){const e=r.$implicit,a=t.oxw(3);t.xp6(3),t.Oqu(e.label),t.xp6(2),t.hij("",e.percent,"%"),t.xp6(2),t.Q6J("ngClass",t.qbA(3,h,a.widthClass(e.percent),"success"===e.tone?"bg-success":"","info"===e.tone?"bg-secondary":"","warning"===e.tone?"bg-warning":"","danger"===e.tone?"bg-danger":""))}}function H(n,r){if(1&n&&(t.TgZ(0,"tr",46)(1,"td",47),t._uU(2),t.qZA(),t.TgZ(3,"td",47),t._uU(4),t.qZA(),t.TgZ(5,"td",47),t._uU(6),t.qZA(),t.TgZ(7,"td",47),t._uU(8),t.qZA(),t.TgZ(9,"td",47),t._UZ(10,"r360-status-badge",27),t.qZA(),t.TgZ(11,"td",47)(12,"a",66),t._uU(13),t.qZA()()()),2&n){const e=r.$implicit,a=t.oxw(3);t.xp6(2),t.Oqu(a.formatMetric(e.amount)),t.xp6(2),t.Oqu(e.property),t.xp6(2),t.Oqu(e.unit),t.xp6(2),t.Oqu(e.description),t.xp6(2),t.Q6J("value",e.status),t.xp6(3),t.Oqu(e.action)}}function R(n,r){if(1&n&&(t.TgZ(0,"section",55)(1,"r360-card",56)(2,"h3",57),t._uU(3,"Payments Overview"),t.qZA(),t.YNc(4,$,8,9,"div",58),t.qZA(),t.TgZ(5,"r360-card",59)(6,"div",60)(7,"h3",61),t._uU(8),t.qZA(),t._UZ(9,"r360-pagination"),t.qZA(),t.TgZ(10,"r360-table")(11,"thead")(12,"tr",40)(13,"th",41),t._uU(14,"Amount"),t.qZA(),t.TgZ(15,"th",41),t._uU(16,"Property"),t.qZA(),t.TgZ(17,"th",41),t._uU(18,"Unit"),t.qZA(),t.TgZ(19,"th",41),t._uU(20,"Description"),t.qZA(),t.TgZ(21,"th",41),t._uU(22,"Status"),t.qZA(),t.TgZ(23,"th",41),t._uU(24,"Actions"),t.qZA()()(),t.TgZ(25,"tbody"),t.YNc(26,H,14,6,"tr",42),t.qZA()()()()),2&n){const e=t.oxw().ngIf,a=t.oxw();t.xp6(4),t.Q6J("ngForOf",e.collectionHealth),t.xp6(4),t.Oqu(a.chargesTitle),t.xp6(18),t.Q6J("ngForOf",e.charges)}}function j(n,r){if(1&n&&(t.TgZ(0,"div",62)(1,"div",63)(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"span"),t._uU(5),t.qZA()(),t.TgZ(6,"div",64),t._UZ(7,"div",65),t.qZA()()),2&n){const e=r.$implicit,a=t.oxw(3);t.xp6(3),t.Oqu(e.label),t.xp6(2),t.hij("",e.percent,"%"),t.xp6(2),t.Q6J("ngClass",t.qbA(3,h,a.widthClass(e.percent),"success"===e.tone?"bg-success":"","info"===e.tone?"bg-secondary":"","warning"===e.tone?"bg-warning":"","danger"===e.tone?"bg-danger":""))}}function L(n,r){if(1&n&&(t.TgZ(0,"tr",46)(1,"td",47),t._uU(2),t.qZA(),t.TgZ(3,"td",47),t._uU(4),t.qZA(),t.TgZ(5,"td",47),t._uU(6),t.qZA(),t.TgZ(7,"td",47),t._uU(8),t.qZA(),t.TgZ(9,"td",47),t._UZ(10,"r360-status-badge",27),t.qZA(),t.TgZ(11,"td",47)(12,"a",66),t._uU(13),t.qZA()()()),2&n){const e=r.$implicit,a=t.oxw(3);t.xp6(2),t.Oqu(a.formatMetric(e.amount)),t.xp6(2),t.Oqu(e.property),t.xp6(2),t.Oqu(e.unit),t.xp6(2),t.Oqu(e.description),t.xp6(2),t.Q6J("value",e.status),t.xp6(3),t.Oqu(e.action)}}function z(n,r){if(1&n&&(t.TgZ(0,"section",55)(1,"r360-card",56)(2,"h3",57),t._uU(3,"Task Completion Health"),t.qZA(),t.YNc(4,j,8,9,"div",58),t.qZA(),t.TgZ(5,"r360-card",59)(6,"div",60)(7,"h3",61),t._uU(8),t.qZA(),t._UZ(9,"r360-pagination"),t.qZA(),t.TgZ(10,"r360-table")(11,"thead")(12,"tr",40)(13,"th",41),t._uU(14,"Payout"),t.qZA(),t.TgZ(15,"th",41),t._uU(16,"Property"),t.qZA(),t.TgZ(17,"th",41),t._uU(18,"Unit"),t.qZA(),t.TgZ(19,"th",41),t._uU(20,"Task"),t.qZA(),t.TgZ(21,"th",41),t._uU(22,"Status"),t.qZA(),t.TgZ(23,"th",41),t._uU(24,"Actions"),t.qZA()()(),t.TgZ(25,"tbody"),t.YNc(26,L,14,6,"tr",42),t.qZA()()()()),2&n){const e=t.oxw().ngIf,a=t.oxw();t.xp6(4),t.Q6J("ngForOf",e.collectionHealth),t.xp6(4),t.Oqu(a.chargesTitle),t.xp6(18),t.Q6J("ngForOf",e.charges)}}function B(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1),t._UZ(2,"r360-page-header",2),t.TgZ(3,"section",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"span",7),t._uU(8),t.qZA()(),t.TgZ(9,"p",8),t._uU(10),t.qZA(),t.YNc(11,C,2,1,"div",9),t.TgZ(12,"div",10)(13,"div",11)(14,"span",12),t._uU(15,"Action Items"),t.qZA(),t.TgZ(16,"span",13),t._uU(17),t.qZA()(),t.TgZ(18,"div",11)(19,"span",12),t._uU(20,"Completion Score"),t.qZA(),t.TgZ(21,"span",13),t._uU(22),t.qZA()(),t.TgZ(23,"div",11)(24,"span",12),t._uU(25,"Priority Focus"),t.qZA(),t.TgZ(26,"span",13),t._uU(27),t.qZA()()()(),t.TgZ(28,"div",14)(29,"label",15),t._uU(30," Month "),t.TgZ(31,"select",16),t.NdJ("change",function(o){t.CHM(e);const s=t.oxw();return t.KtG(s.changeMonth(o.target.value))}),t.YNc(32,P,2,2,"option",17),t.qZA()(),t.TgZ(33,"label",15),t._uU(34," Year "),t.TgZ(35,"select",16),t.NdJ("change",function(o){t.CHM(e);const s=t.oxw();return t.KtG(s.changeYear(o.target.value))}),t.YNc(36,M,2,2,"option",17),t.qZA()()()()(),t.TgZ(37,"section",18)(38,"h2",19),t._uU(39),t.qZA(),t.TgZ(40,"div",20),t.YNc(41,D,5,2,"r360-card",21),t.qZA()(),t.YNc(42,I,91,6,"section",22),t.YNc(43,V,5,1,"section",22),t.YNc(44,R,27,3,"section",23),t.YNc(45,z,27,3,"section",23),t.qZA(),t.BQk()}if(2&n){const e=r.ngIf,a=t.oxw();t.xp6(2),t.Q6J("title","Good Morning, "+a.userName),t.xp6(6),t.Oqu(a.viewLabel),t.xp6(2),t.Oqu(a.roleSummary()),t.xp6(1),t.Q6J("ngIf",a.availablePersonas.length>1),t.xp6(6),t.Oqu(a.pendingItems(e)),t.xp6(5),t.hij("",a.completionScore(e),"%"),t.xp6(5),t.Oqu(a.focusLabel(e)),t.xp6(4),t.Q6J("value",a.selectedMonth),t.xp6(1),t.Q6J("ngForOf",a.monthOptions),t.xp6(3),t.Q6J("value",a.selectedYear),t.xp6(1),t.Q6J("ngForOf",a.yearOptions),t.xp6(3),t.Oqu(a.viewLabel),t.xp6(2),t.Q6J("ngForOf",e.kpis),t.xp6(1),t.Q6J("ngIf","societyAdmin"===a.selectedPersona&&e.adminView),t.xp6(1),t.Q6J("ngIf",a.insights.length&&"tenant"!==a.selectedPersona),t.xp6(1),t.Q6J("ngIf","vendor"!==a.selectedPersona),t.xp6(1),t.Q6J("ngIf","vendor"===a.selectedPersona)}}const X=[{path:"",component:(()=>{class n{constructor(e,a,o,s){this.dashboardData=e,this.settings=a,this.auth=o,this.refresh=s,this.data=null,this.insights=[],this.userName="User",this.locale="en-US",this.currency="USD",this.baseData=null,this.subscriptions=new b.w0,this.availablePersonas=[],this.selectedPersona="owner",this.selectedMonth=(new Date).getMonth()+1,this.selectedYear=(new Date).getFullYear(),this.yearOptions=[2024,2025,2026,2027],this.monthOptions=[{value:1,label:"Jan"},{value:2,label:"Feb"},{value:3,label:"Mar"},{value:4,label:"Apr"},{value:5,label:"May"},{value:6,label:"Jun"},{value:7,label:"Jul"},{value:8,label:"Aug"},{value:9,label:"Sep"},{value:10,label:"Oct"},{value:11,label:"Nov"},{value:12,label:"Dec"}]}ngOnInit(){this.subscriptions.add(this.settings.userSettings$.subscribe(e=>{this.userName=e.fullName,this.locale="hi"===e.language?"hi-IN":"en-US",this.currency=e.currency,this.baseData&&this.applyPeriodFilter()})),this.initializePersonas(),this.loadPersona(this.selectedPersona),this.subscriptions.add(this.refresh.propertiesChanged$.subscribe(()=>{this.loadPersona(this.selectedPersona)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get viewLabel(){return"tenant"===this.selectedPersona?"Tenant View":"societyAdmin"===this.selectedPersona?"Society Admin View":"vendor"===this.selectedPersona?"Vendor View":"Owner View"}get chargesTitle(){return"tenant"===this.selectedPersona?"Your Charges":"societyAdmin"===this.selectedPersona?"Society Billing":"vendor"===this.selectedPersona?"Task Payout Queue":"Owner Charges"}personaLabel(e){return"tenant"===e?"Tenant":"societyAdmin"===e?"Society Admin":"vendor"===e?"Vendor":"Owner"}selectPersona(e){this.selectedPersona!==e&&(this.selectedPersona=e,this.loadPersona(e))}changeMonth(e){this.selectedMonth=Number(e),this.applyPeriodFilter()}changeYear(e){this.selectedYear=Number(e),this.applyPeriodFilter()}widthClass(e){return e>=90?"w-[90%]":e>=80?"w-[80%]":e>=70?"w-[70%]":e>=60?"w-[60%]":e>=50?"w-[50%]":e>=40?"w-[40%]":e>=30?"w-[30%]":e>=20?"w-[20%]":e>=10?"w-[10%]":"w-[5%]"}roleSummary(){return"tenant"===this.selectedPersona?"Track your dues, payment health, and upcoming actions in one place.":"societyAdmin"===this.selectedPersona?"Monitor society operations, member health, and collection risk quickly.":"vendor"===this.selectedPersona?"Stay on top of assigned work orders, completion pace, and payout readiness.":"Monitor portfolio collection trends, occupancy, and high-priority follow-ups."}pendingItems(e){return e.charges.filter(a=>"Paid"!==a.status).length}completionScore(e){if(!e.collectionHealth.length)return 0;const o=e.collectionHealth.reduce((s,d)=>s+d.percent*("success"===d.tone?1.2:"info"===d.tone?1:"warning"===d.tone?.6:.4),0)/e.collectionHealth.length;return Math.max(0,Math.min(100,Math.round(o)))}focusLabel(e){if(!e.collectionHealth.length)return"No focus item";const a=e.collectionHealth.filter(o=>"warning"===o.tone||"danger"===o.tone).sort((o,s)=>s.percent-o.percent)[0];return a?a.label:e.collectionHealth[0].label}initializePersonas(){const e=this.auth.snapshotUser?.roles??[],a=[];e.includes("owner")&&a.push("owner"),e.includes("tenant")&&a.push("tenant"),e.includes("societyAdmin")&&a.push("societyAdmin"),e.includes("vendor")&&a.push("vendor"),this.availablePersonas=a.length?a:["owner"],this.selectedPersona="tenant"===this.settings.snapshot.defaultDashboard&&this.availablePersonas.includes("tenant")?"tenant":this.availablePersonas[0]}loadPersona(e){this.dashboardData.getScreenData(e).subscribe(o=>{this.baseData=o.overview,this.insights=o.insights,this.applyPeriodFilter()})}applyPeriodFilter(){if(!this.baseData)return;const e=this.deepClone(this.baseData),a=this.getMonthFactor(this.selectedMonth),o=this.getYearFactor(this.selectedYear),s=a*o,d=a*o;e.kpis=e.kpis.map(i=>({...i,value:this.scaleValue(i.value,s,d)})),e.charges=e.charges.map(i=>({...i,amount:this.scaleMoney(i.amount,s)})),e.collectionHealth=e.collectionHealth.map(i=>{const m=Math.round(20*(a-1)+12*(o-1)),E="warning"===i.tone||"danger"===i.tone?-m:m;return{...i,percent:this.clampPercent(i.percent+E)}}),e.adminView&&(e.adminView.ownerInsights=e.adminView.ownerInsights.map(i=>({...i,value:this.scaleValue(i.value,s,d)})),e.adminView.tenantInsights=e.adminView.tenantInsights.map(i=>({...i,value:this.scaleValue(i.value,s,d)})),e.adminView.operationsInsights=e.adminView.operationsInsights.map(i=>({...i,value:this.scaleValue(i.value,s,d)})),e.adminView.defaulters=e.adminView.defaulters.map(i=>({...i,rentDue:this.scaleMoney(i.rentDue,s),maintenanceDue:this.scaleMoney(i.maintenanceDue,s),daysLate:i.daysLate}))),this.data=e}scaleValue(e,a,o){if(e.includes("$"))return this.scaleMoney(e,a);const s=this.extractNumber(e);return null===s?e:Math.max(0,Math.round(s*o)).toLocaleString(this.locale)}scaleMoney(e,a){const o=this.extractNumber(e);return null===o?e:new Intl.NumberFormat(this.locale,{style:"currency",currency:this.currency,minimumFractionDigits:2,maximumFractionDigits:2}).format(o*a)}formatMetric(e){if(!e.includes("$"))return e;const a=this.extractNumber(e);return null===a?e:new Intl.NumberFormat(this.locale,{style:"currency",currency:this.currency,minimumFractionDigits:2,maximumFractionDigits:2}).format(a)}extractNumber(e){const a=Number(e.replace(/[^0-9.-]+/g,""));return Number.isFinite(a)?a:null}clampPercent(e){return Math.min(98,Math.max(3,e))}getMonthFactor(e){return{1:.92,2:.94,3:.97,4:.99,5:1.01,6:1.03,7:1.05,8:1.04,9:1.02,10:1.01,11:.98,12:.95}[e]??1}getYearFactor(e){return e<=2024?.9:2025===e?.96:2026===e?1:1.08}deepClone(e){return JSON.parse(JSON.stringify(e))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(f.n),t.Y36(Z.s),t.Y36(x.e),t.Y36(T.y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-dashboard"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"r360-page","dashboard-enter"],["subtitle","Role-based overview",3,"title"],[1,"r360-section","r360-panel","dashboard-surface"],[1,"dashboard-toolbar"],[1,"dashboard-summary"],[1,"dashboard-role-line"],[1,"dashboard-role-pill"],[1,"dashboard-summary-text"],["class","flex flex-wrap items-center gap-2",4,"ngIf"],[1,"dashboard-mini-grid"],[1,"dashboard-mini-card"],[1,"dashboard-mini-label"],[1,"dashboard-mini-value"],[1,"dashboard-filters"],[1,"text-xs","font-medium","text-gray-500","dark:text-gray-300"],[1,"r360-input","mt-1","!py-1.5",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[1,"r360-section"],[1,"mb-4","break-words","text-xl","font-semibold","sm:text-2xl"],[1,"grid","grid-cols-1","gap-4","sm:grid-cols-2","2xl:grid-cols-4"],["class","block dashboard-kpi-card",4,"ngFor","ngForOf"],["class","r360-section",4,"ngIf"],["class","grid grid-cols-1 gap-4 xl:grid-cols-5",4,"ngIf"],[1,"flex","flex-wrap","items-center","gap-2"],["type","button","class","r360-chip dashboard-chip",3,"ngClass","click",4,"ngFor","ngForOf"],["type","button",1,"r360-chip","dashboard-chip",3,"ngClass","click"],[3,"value"],[1,"block","dashboard-kpi-card"],[1,"mb-2","text-xs","uppercase","tracking-wide","text-gray-500"],[1,"r360-kpi-value"],[1,"mb-4","text-xl","font-semibold"],[1,"grid","grid-cols-1","gap-4","xl:grid-cols-3"],[1,"mb-3","text-sm","font-semibold"],[1,"space-y-2"],["class","flex items-center justify-between text-sm",4,"ngFor","ngForOf"],[1,"mt-4","grid","grid-cols-1","gap-4"],[1,"mb-4","flex","items-center","justify-between"],[1,"text-lg","font-semibold"],[1,"text-xs","text-gray-500"],[1,"border-b","border-gray-200","dark:border-gray-700"],[1,"r360-th"],["class","r360-row",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","text-sm"],[1,"text-gray-500","dark:text-gray-300"],[1,"font-semibold"],[1,"r360-row"],[1,"r360-td"],[1,"r360-btn-secondary"],[1,"r360-td","font-semibold","text-danger"],[1,"r360-td","font-semibold","text-warning"],[1,"grid","grid-cols-1","gap-4","lg:grid-cols-3"],[1,"text-xs","uppercase","tracking-wide","text-gray-500"],[1,"mt-2","text-2xl","font-bold","text-gray-900","dark:text-gray-100"],[1,"mt-2","text-sm","text-gray-500","dark:text-gray-300"],[1,"grid","grid-cols-1","gap-4","xl:grid-cols-5"],[1,"block","xl:col-span-2"],[1,"mb-6","text-xl","font-semibold"],["class","mb-5 last:mb-0",4,"ngFor","ngForOf"],[1,"block","xl:col-span-3"],[1,"mb-6","flex","items-center","justify-between"],[1,"text-xl","font-semibold"],[1,"mb-5","last:mb-0"],[1,"mb-2","flex","items-center","justify-between","text-sm"],[1,"h-2","overflow-hidden","rounded-lg","bg-gray-200","dark:bg-gray-700"],[1,"dashboard-meter-fill","h-full","rounded-lg",3,"ngClass"],["href","#",1,"r360-action-link"]],template:function(e,a){1&e&&t.YNc(0,B,46,17,"ng-container",0),2&e&&t.Q6J("ngIf",a.data)},dependencies:[l.mk,l.sg,l.O5,p.YN,p.Kr,q.A,A,y,O.q,U.e],styles:['.dashboard-toolbar[_ngcontent-%COMP%]{display:grid;gap:1rem}.dashboard-enter[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{opacity:0;transform:translateY(10px) scale(.995);animation:dashboard-reveal .24s ease-out forwards;will-change:transform,opacity}.dashboard-enter[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(1){animation-delay:.04s}.dashboard-enter[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(2){animation-delay:.1s}.dashboard-enter[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(3){animation-delay:.16s}.dashboard-enter[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(4){animation-delay:.22s}.dashboard-enter[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(5){animation-delay:.28s}.dashboard-enter[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(6){animation-delay:.34s}.dashboard-surface[_ngcontent-%COMP%]{position:relative;overflow:hidden}.dashboard-surface[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:-120% -20% auto;height:210%;background:linear-gradient(120deg,transparent,rgba(14,165,233,.08),transparent);transform:translate(-85%);animation:dashboard-sheen 1.1s ease-out 1;pointer-events:none}.dashboard-summary[_ngcontent-%COMP%]{display:grid;gap:.75rem}.dashboard-role-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.dashboard-role-pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;border:1px solid rgb(191,219,254);background:rgb(239,246,255);color:#1e40af;border-radius:999px;padding:.2rem .7rem;font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.04em}.dark[_ngcontent-%COMP%]   .dashboard-role-pill[_ngcontent-%COMP%]{border-color:#7dd3fc6b;background:rgba(14,165,233,.2);color:#dff8ff}.dashboard-summary-text[_ngcontent-%COMP%]{font-size:.9rem;color:#4b5563;max-width:48rem}.dashboard-mini-grid[_ngcontent-%COMP%]{display:grid;gap:.6rem;grid-template-columns:repeat(1,minmax(0,1fr))}.dashboard-mini-card[_ngcontent-%COMP%]{border:1px solid rgb(229,231,235);border-radius:.75rem;background:rgb(255,255,255);padding:.65rem .8rem;display:grid;gap:.2rem;transition:transform .18s ease,box-shadow .2s ease}.dashboard-mini-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 10px 18px #0f172a14}.dark[_ngcontent-%COMP%]   .dashboard-mini-card[_ngcontent-%COMP%]{border-color:#47556999;background:rgba(15,23,42,.5)}.dashboard-mini-label[_ngcontent-%COMP%]{font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:.04em;color:#6b7280}.dashboard-mini-value[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#111827}.dark[_ngcontent-%COMP%]   .dashboard-mini-value[_ngcontent-%COMP%]{color:#e2e8f0}.dashboard-chip[_ngcontent-%COMP%]{transition:transform .15s ease,box-shadow .2s ease}.dashboard-chip[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.dashboard-kpi-card[_ngcontent-%COMP%]{position:relative;overflow:hidden;transition:transform .14s ease,box-shadow .16s ease}.dashboard-kpi-card[_ngcontent-%COMP%]:before{content:"";position:absolute;left:.9rem;right:.9rem;top:0;height:2px;border-radius:999px;background:linear-gradient(90deg,rgba(20,184,166,.7),rgba(14,165,233,.8));opacity:.75}.dashboard-kpi-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 16px 30px #0f172a1f}.dashboard-meter-fill[_ngcontent-%COMP%]{transition:width .28s ease;animation:dashboard-meter-in .24s ease both;will-change:transform,opacity}.dashboard-filters[_ngcontent-%COMP%]{display:grid;gap:.6rem;grid-template-columns:repeat(1,minmax(0,1fr))}@media (min-width: 640px){.dashboard-mini-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,minmax(0,1fr))}.dashboard-filters[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (min-width: 1280px){.dashboard-toolbar[_ngcontent-%COMP%]{grid-template-columns:minmax(0,1fr) 320px;align-items:start}.dashboard-filters[_ngcontent-%COMP%]{justify-self:end;width:100%}}@media (prefers-reduced-motion: reduce){.dashboard-enter[_ngcontent-%COMP%] > *[_ngcontent-%COMP%], .dashboard-surface[_ngcontent-%COMP%]:after, .dashboard-meter-fill[_ngcontent-%COMP%]{animation:none!important;transition:none!important;transform:none!important;opacity:1!important}}@keyframes dashboard-reveal{to{opacity:1;transform:translateY(0) scale(1)}}@keyframes dashboard-meter-in{0%{opacity:.7;transform:scaleX(.94);transform-origin:left}to{opacity:1;transform:scaleX(1)}}@keyframes dashboard-sheen{0%,to{transform:translate(-85%)}50%{transform:translate(85%)}}']}),n})()}];let G=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[g.Bz.forChild(X),g.Bz]}),n})(),K=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[_.m,G]}),n})()}}]);